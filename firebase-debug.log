[debug] [2026-03-01T04:42:29.713Z] ----------------------------------------------------------------------
[debug] [2026-03-01T04:42:29.719Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\anive\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js deploy --only firestore:rules --project tasktimer-prod
[debug] [2026-03-01T04:42:29.719Z] CLI Version:   15.8.0
[debug] [2026-03-01T04:42:29.720Z] Platform:      win32
[debug] [2026-03-01T04:42:29.720Z] Node Version:  v24.13.1
[debug] [2026-03-01T04:42:29.720Z] Time:          Sun Mar 01 2026 15:42:29 GMT+1100 (Australian Eastern Daylight Time)
[debug] [2026-03-01T04:42:29.720Z] ----------------------------------------------------------------------
[debug] 
[debug] [2026-03-01T04:42:29.723Z] >>> [apiv2][query] GET https://firebase-public.firebaseio.com/cli.json [none]
[debug] [2026-03-01T04:42:34.515Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2026-03-01T04:42:34.516Z] > authorizing via signed-in user (aniven82@gmail.com)
[debug] [2026-03-01T04:42:34.516Z] [iam] checking project tasktimer-prod for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2026-03-01T04:42:34.517Z] Checked if tokens are valid: false, expires at: 1772068051743
[debug] [2026-03-01T04:42:34.518Z] Checked if tokens are valid: false, expires at: 1772068051743
[debug] [2026-03-01T04:42:34.518Z] > refreshing access token with scopes: []
[debug] [2026-03-01T04:42:34.520Z] >>> [apiv2][query] POST https://www.googleapis.com/oauth2/v3/token [none]
[debug] [2026-03-01T04:42:34.520Z] >>> [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2026-03-01T04:42:34.746Z] <<< [apiv2][status] POST https://www.googleapis.com/oauth2/v3/token 200
[debug] [2026-03-01T04:42:34.746Z] <<< [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2026-03-01T04:42:34.771Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions [none]
[debug] [2026-03-01T04:42:34.771Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions  x-goog-user-project=tasktimer-prod
[debug] [2026-03-01T04:42:34.771Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2026-03-01T04:42:34.954Z] <<< [apiv2][status] GET https://firebase-public.firebaseio.com/cli.json 200
[debug] [2026-03-01T04:42:34.954Z] <<< [apiv2][body] GET https://firebase-public.firebaseio.com/cli.json {"cloudBuildErrorAfter":1594252800000,"cloudBuildWarnAfter":1590019200000,"defaultNode10After":1594252800000,"minVersion":"3.0.5","node8DeploysDisabledAfter":1613390400000,"node8RuntimeDisabledAfter":1615809600000,"node8WarnAfter":1600128000000}
[debug] [2026-03-01T04:42:35.887Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions 200
[debug] [2026-03-01T04:42:35.887Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'tasktimer-prod'...
[info] 
[info] i  deploying firestore 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[debug] [2026-03-01T04:42:35.891Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:35.891Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:35.891Z] >>> [apiv2][query] GET https://serviceusage.googleapis.com/v1/projects/tasktimer-prod/services/firestore.googleapis.com [none]
[debug] [2026-03-01T04:42:35.891Z] >>> [apiv2][(partial)header] GET https://serviceusage.googleapis.com/v1/projects/tasktimer-prod/services/firestore.googleapis.com  x-goog-user-project=tasktimer-prod
[debug] [2026-03-01T04:42:37.530Z] <<< [apiv2][status] GET https://serviceusage.googleapis.com/v1/projects/tasktimer-prod/services/firestore.googleapis.com 200
[debug] [2026-03-01T04:42:37.530Z] <<< [apiv2][body] GET https://serviceusage.googleapis.com/v1/projects/tasktimer-prod/services/firestore.googleapis.com [omitted]
[info] +  firestore: required API firestore.googleapis.com is enabled 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[debug] [2026-03-01T04:42:37.541Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:37.541Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:37.541Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/(default) [none]
[debug] [2026-03-01T04:42:38.365Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/(default) 404
[debug] [2026-03-01T04:42:38.366Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/(default) {"error":{"code":404,"message":"Project 'tasktimer-prod' or database '(default)' does not exist.","status":"NOT_FOUND"}}
[info] i  firestore: Creating the new Firestore database (default)... 
[debug] [2026-03-01T04:42:38.368Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:38.368Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:38.368Z] >>> [apiv2][query] POST https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases databaseId=%28default%29
[debug] [2026-03-01T04:42:38.368Z] >>> [apiv2][body] POST https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases {"locationId":"nam5","type":"FIRESTORE_NATIVE","databaseEdition":"STANDARD","deleteProtectionState":"DELETE_PROTECTION_DISABLED","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED"}
[debug] [2026-03-01T04:42:41.579Z] <<< [apiv2][status] POST https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases 200
[debug] [2026-03-01T04:42:41.579Z] <<< [apiv2][body] POST https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases {"name":"projects/tasktimer-prod/databases/(default)/operations/aefx1ELSCr-GQki0xSkOaxAqNW1hbgQiBRABoLLR8BAGzY-HwQgMCiga","metadata":{"@type":"type.googleapis.com/google.firestore.admin.v1.CreateDatabaseMetadata"},"response":{"@type":"type.googleapis.com/google.firestore.admin.v1.Database","name":"projects/tasktimer-prod/databases/(default)","uid":"6b0e29c5-b448-4286-bf0a-d242d4f1e769","createTime":"2026-03-01T04:42:41.336374Z","updateTime":"2026-03-01T04:42:41.336374Z","locationId":"nam5","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2026-03-01T04:42:41.336374Z","appEngineIntegrationMode":"DISABLED","keyPrefix":"s","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":true,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"IIGn9M3x/ZIDMLao883x/ZID"}}
[debug] [2026-03-01T04:42:41.580Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:41.580Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:41.581Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/(default)/operations/aefx1ELSCr-GQki0xSkOaxAqNW1hbgQiBRABoLLR8BAGzY-HwQgMCiga [none]
[debug] [2026-03-01T04:42:42.288Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/(default)/operations/aefx1ELSCr-GQki0xSkOaxAqNW1hbgQiBRABoLLR8BAGzY-HwQgMCiga 200
[debug] [2026-03-01T04:42:42.288Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/(default)/operations/aefx1ELSCr-GQki0xSkOaxAqNW1hbgQiBRABoLLR8BAGzY-HwQgMCiga {"name":"projects/tasktimer-prod/databases/(default)/operations/aefx1ELSCr-GQki0xSkOaxAqNW1hbgQiBRABoLLR8BAGzY-HwQgMCiga","metadata":{"@type":"type.googleapis.com/google.firestore.admin.v1.CreateDatabaseMetadata"},"done":true,"response":{"@type":"type.googleapis.com/google.firestore.admin.v1.Database","name":"projects/tasktimer-prod/databases/(default)","uid":"6b0e29c5-b448-4286-bf0a-d242d4f1e769","createTime":"2026-03-01T04:42:41.336374Z","updateTime":"2026-03-01T04:42:41.336374Z","locationId":"nam5","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2026-03-01T04:42:41.336374Z","appEngineIntegrationMode":"DISABLED","keyPrefix":"s","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":true,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"IPGzhc7x/ZIDMLao883x/ZID"}}
[info] i  cloud.firestore: checking firestore.rules for compilation errors... 
[debug] [2026-03-01T04:42:42.290Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:42.290Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:42.290Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test [none]
[debug] [2026-03-01T04:42:42.290Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test [omitted]
[debug] [2026-03-01T04:42:43.282Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test 200
[debug] [2026-03-01T04:42:43.283Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test {}
[info] +  cloud.firestore: rules file firestore.rules compiled successfully 
[debug] [2026-03-01T04:42:43.286Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:43.286Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:43.286Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases pageSize=10&pageToken=
[debug] [2026-03-01T04:42:44.590Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases 200
[debug] [2026-03-01T04:42:44.591Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases {"releases":[{"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/f7eadc29-c2d6-4425-a226-19243e57d5ce","createTime":"2026-02-28T10:53:36.946559Z","updateTime":"2026-03-01T04:32:49.040351Z"},{"name":"projects/tasktimer-prod/releases/firebase.storage/tasktimer-prod.firebasestorage.app","rulesetName":"projects/tasktimer-prod/rulesets/ede5bb01-bb12-4bbb-8fcf-22ca8360ba5a","createTime":"2026-02-25T22:57:18.663407Z","updateTime":"2026-02-25T22:57:18.663407Z"}]}
[debug] [2026-03-01T04:42:44.607Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:44.607Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:44.607Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/f7eadc29-c2d6-4425-a226-19243e57d5ce [none]
[debug] [2026-03-01T04:42:45.906Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/f7eadc29-c2d6-4425-a226-19243e57d5ce 200
[debug] [2026-03-01T04:42:45.906Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/f7eadc29-c2d6-4425-a226-19243e57d5ce [omitted]
[info] i  firestore: uploading rules firestore.rules... 
[debug] [2026-03-01T04:42:45.907Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:45.907Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:45.908Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets [none]
[debug] [2026-03-01T04:42:45.908Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets [omitted]
[debug] [2026-03-01T04:42:47.477Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets 200
[debug] [2026-03-01T04:42:47.477Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets {"name":"projects/tasktimer-prod/rulesets/b12e25d5-68db-43ef-933f-63c41dd16b7c","source":{"files":[{"content":"rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    function isOwner(userId) {\n      return request.auth != null && request.auth.uid == userId;\n    }\n\n    function onlyKeys(allowed) {\n      return request.resource.data.keys().hasOnly(allowed);\n    }\n\n    function isUserDoc() {\n      return onlyKeys([\n        \"email\",\n        \"displayName\",\n        \"avatarId\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"schemaVersion\"\n      ])\n      && (!(\"email\" in request.resource.data) || request.resource.data.email is string)\n      && (!(\"displayName\" in request.resource.data) || request.resource.data.displayName == null || request.resource.data.displayName is string)\n      && (!(\"avatarId\" in request.resource.data) || request.resource.data.avatarId is string)\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int);\n    }\n\n    function isPreferencesV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"theme\",\n        \"defaultTaskTimerFormat\",\n        \"dynamicColorsEnabled\",\n        \"checkpointAlertSoundEnabled\",\n        \"checkpointAlertToastEnabled\",\n        \"modeSettings\",\n        \"updatedAtMs\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"theme\" in request.resource.data) || request.resource.data.theme in [\"light\", \"dark\"])\n      && (!(\"defaultTaskTimerFormat\" in request.resource.data) || request.resource.data.defaultTaskTimerFormat in [\"day\", \"hour\", \"minute\"])\n      && (!(\"dynamicColorsEnabled\" in request.resource.data) || request.resource.data.dynamicColorsEnabled is bool)\n      && (!(\"checkpointAlertSoundEnabled\" in request.resource.data) || request.resource.data.checkpointAlertSoundEnabled is bool)\n      && (!(\"checkpointAlertToastEnabled\" in request.resource.data) || request.resource.data.checkpointAlertToastEnabled is bool)\n      && (!(\"modeSettings\" in request.resource.data) || request.resource.data.modeSettings == null || request.resource.data.modeSettings is map)\n      && (!(\"updatedAtMs\" in request.resource.data) || request.resource.data.updatedAtMs is int)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isDashboardV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"order\",\n        \"widgets\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"order\" in request.resource.data) || request.resource.data.order is list)\n      && (!(\"widgets\" in request.resource.data) || request.resource.data.widgets is map)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isTaskUiV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"historyRangeDaysByTaskId\",\n        \"historyRangeModeByTaskId\",\n        \"pinnedHistoryTaskIds\",\n        \"customTaskNames\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"historyRangeDaysByTaskId\" in request.resource.data) || request.resource.data.historyRangeDaysByTaskId is map)\n      && (!(\"historyRangeModeByTaskId\" in request.resource.data) || request.resource.data.historyRangeModeByTaskId is map)\n      && (!(\"pinnedHistoryTaskIds\" in request.resource.data) || request.resource.data.pinnedHistoryTaskIds is list)\n      && (!(\"customTaskNames\" in request.resource.data) || request.resource.data.customTaskNames is list)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isAccountStateV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"friendInviteKey\",\n        \"friendInviteKeyExpiresAt\",\n        \"deleteReauthPending\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"friendInviteKey\" in request.resource.data) || request.resource.data.friendInviteKey == null || request.resource.data.friendInviteKey is string)\n      && (!(\"friendInviteKeyExpiresAt\" in request.resource.data) || request.resource.data.friendInviteKeyExpiresAt == null || request.resource.data.friendInviteKeyExpiresAt is int)\n      && (!(\"deleteReauthPending\" in request.resource.data) || request.resource.data.deleteReauthPending is bool)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isTaskDoc() {\n      return onlyKeys([\n        \"id\",\n        \"name\",\n        \"order\",\n        \"collapsed\",\n        \"color\",\n        \"accumulatedMs\",\n        \"running\",\n        \"startMs\",\n        \"hasStarted\",\n        \"checkpointsEnabled\",\n        \"checkpointTimeUnit\",\n        \"checkpoints\",\n        \"checkpointSoundEnabled\",\n        \"checkpointSoundMode\",\n        \"checkpointToastEnabled\",\n        \"checkpointToastMode\",\n        \"finalCheckpointAction\",\n        \"presetIntervalsEnabled\",\n        \"presetIntervalValue\",\n        \"presetIntervalLastCheckpointId\",\n        \"presetIntervalNextSeq\",\n        \"mode\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"schemaVersion\"\n      ])\n      && (!(\"id\" in request.resource.data) || request.resource.data.id is string)\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"order\" in request.resource.data) || request.resource.data.order is int)\n      && (!(\"collapsed\" in request.resource.data) || request.resource.data.collapsed is bool)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"accumulatedMs\" in request.resource.data) || request.resource.data.accumulatedMs is int)\n      && (!(\"running\" in request.resource.data) || request.resource.data.running is bool)\n      && (!(\"startMs\" in request.resource.data) || request.resource.data.startMs == null || request.resource.data.startMs is int)\n      && (!(\"hasStarted\" in request.resource.data) || request.resource.data.hasStarted is bool)\n      && (!(\"checkpointsEnabled\" in request.resource.data) || request.resource.data.checkpointsEnabled is bool)\n      && (!(\"checkpointTimeUnit\" in request.resource.data) || request.resource.data.checkpointTimeUnit in [\"day\", \"hour\", \"minute\"])\n      && (!(\"checkpoints\" in request.resource.data) || request.resource.data.checkpoints is list)\n      && (!(\"checkpointSoundEnabled\" in request.resource.data) || request.resource.data.checkpointSoundEnabled is bool)\n      && (!(\"checkpointSoundMode\" in request.resource.data) || request.resource.data.checkpointSoundMode in [\"once\", \"repeat\"])\n      && (!(\"checkpointToastEnabled\" in request.resource.data) || request.resource.data.checkpointToastEnabled is bool)\n      && (!(\"checkpointToastMode\" in request.resource.data) || request.resource.data.checkpointToastMode in [\"auto5s\", \"manual\"])\n      && (!(\"finalCheckpointAction\" in request.resource.data) || request.resource.data.finalCheckpointAction in [\"continue\", \"resetLog\", \"resetNoLog\"])\n      && (!(\"presetIntervalsEnabled\" in request.resource.data) || request.resource.data.presetIntervalsEnabled is bool)\n      && (!(\"presetIntervalValue\" in request.resource.data) || request.resource.data.presetIntervalValue is int || request.resource.data.presetIntervalValue is float)\n      && (!(\"presetIntervalLastCheckpointId\" in request.resource.data) || request.resource.data.presetIntervalLastCheckpointId == null || request.resource.data.presetIntervalLastCheckpointId is string)\n      && (!(\"presetIntervalNextSeq\" in request.resource.data) || request.resource.data.presetIntervalNextSeq is int)\n      && (!(\"mode\" in request.resource.data) || request.resource.data.mode in [\"mode1\", \"mode2\", \"mode3\"])\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int);\n    }\n\n    function isHistoryDoc() {\n      return onlyKeys([\n        \"ts\",\n        \"name\",\n        \"ms\",\n        \"color\",\n        \"createdAt\"\n      ])\n      && (!(\"ts\" in request.resource.data) || request.resource.data.ts is int)\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"ms\" in request.resource.data) || request.resource.data.ms is int)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp);\n    }\n\n    function isDeletedTaskDoc() {\n      return onlyKeys([\n        \"name\",\n        \"color\",\n        \"deletedAt\",\n        \"updatedAt\"\n      ])\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"deletedAt\" in request.resource.data) || request.resource.data.deletedAt is int)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isFriendRequestDocShape() {\n      return onlyKeys([\n        \"requestId\",\n        \"senderUid\",\n        \"receiverUid\",\n        \"senderEmail\",\n        \"receiverEmail\",\n        \"status\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"respondedAt\",\n        \"respondedBy\"\n      ])\n      && (!(\"requestId\" in request.resource.data) || request.resource.data.requestId is string)\n      && (!(\"senderUid\" in request.resource.data) || request.resource.data.senderUid is string)\n      && (!(\"receiverUid\" in request.resource.data) || request.resource.data.receiverUid is string)\n      && (!(\"senderEmail\" in request.resource.data) || request.resource.data.senderEmail == null || request.resource.data.senderEmail is string)\n      && (!(\"receiverEmail\" in request.resource.data) || request.resource.data.receiverEmail == null || request.resource.data.receiverEmail is string)\n      && (!(\"status\" in request.resource.data) || request.resource.data.status in [\"pending\", \"approved\", \"declined\"])\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"respondedAt\" in request.resource.data) || request.resource.data.respondedAt == null || request.resource.data.respondedAt is timestamp)\n      && (!(\"respondedBy\" in request.resource.data) || request.resource.data.respondedBy == null || request.resource.data.respondedBy is string);\n    }\n\n    function isFriendRequestCreateDoc() {\n      return isFriendRequestDocShape()\n      && request.resource.data.keys().hasAll([\n        \"requestId\",\n        \"senderUid\",\n        \"receiverUid\",\n        \"status\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"respondedAt\",\n        \"respondedBy\"\n      ])\n      && request.resource.data.requestId == (\"pending:\" + request.resource.data.senderUid + \":\" + request.resource.data.receiverUid)\n      && request.resource.data.status == \"pending\"\n      && request.resource.data.senderUid != request.resource.data.receiverUid\n      && request.resource.data.respondedAt == null\n      && request.resource.data.respondedBy == null;\n    }\n\n    function isFriendRequestDecisionUpdate() {\n      return isFriendRequestDocShape()\n      && request.auth != null\n      && request.auth.uid == resource.data.receiverUid\n      && resource.data.status == \"pending\"\n      && request.resource.data.status in [\"approved\", \"declined\"]\n      && request.resource.data.requestId == resource.data.requestId\n      && request.resource.data.senderUid == resource.data.senderUid\n      && request.resource.data.receiverUid == resource.data.receiverUid\n      && request.resource.data.createdAt == resource.data.createdAt\n      && request.resource.data.respondedBy == request.auth.uid\n      && request.resource.data.respondedAt is timestamp;\n    }\n\n    function isFriendRequestRetryUpdate() {\n      return isFriendRequestDocShape()\n      && request.auth != null\n      && request.auth.uid == resource.data.senderUid\n      && resource.data.status in [\"approved\", \"declined\"]\n      && request.resource.data.status == \"pending\"\n      && request.resource.data.requestId == resource.data.requestId\n      && request.resource.data.senderUid == resource.data.senderUid\n      && request.resource.data.receiverUid == resource.data.receiverUid\n      && request.resource.data.createdAt == resource.data.createdAt\n      && request.resource.data.respondedBy == null\n      && request.resource.data.respondedAt == null;\n    }\n\n    function isFriendshipDocCreate() {\n      return onlyKeys([\n        \"pairId\",\n        \"users\",\n        \"createdAt\",\n        \"createdBy\"\n      ])\n      && request.resource.data.keys().hasAll([\n        \"pairId\",\n        \"users\",\n        \"createdAt\",\n        \"createdBy\"\n      ])\n      && request.auth != null\n      && request.resource.data.pairId is string\n      && request.resource.data.users is list\n      && request.resource.data.users.size() == 2\n      && request.resource.data.users[0] is string\n      && request.resource.data.users[1] is string\n      && request.resource.data.users[0] != request.resource.data.users[1]\n      && request.auth.uid in request.resource.data.users\n      && request.resource.data.createdAt is timestamp\n      && request.resource.data.createdBy is string\n      && (\n        (\n          request.resource.data.users[0] < request.resource.data.users[1]\n          && request.resource.data.pairId == (\"pair:\" + request.resource.data.users[0] + \":\" + request.resource.data.users[1])\n        )\n        || (\n          request.resource.data.users[1] < request.resource.data.users[0]\n          && request.resource.data.pairId == (\"pair:\" + request.resource.data.users[1] + \":\" + request.resource.data.users[0])\n        )\n      );\n    }\n\n    match /users/{userId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isUserDoc();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/preferences/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isPreferencesV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/dashboard/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isDashboardV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/taskUi/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isTaskUiV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/accountState/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isAccountStateV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/tasks/{taskId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isTaskDoc();\n      allow delete: if isOwner(userId);\n\n      match /history/{entryId} {\n        allow read: if isOwner(userId);\n        allow create, update: if isOwner(userId) && isHistoryDoc();\n        allow delete: if isOwner(userId);\n      }\n    }\n\n    match /users/{userId}/deletedTasks/{taskId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isDeletedTaskDoc();\n      allow delete: if isOwner(userId);\n    }\n\n    match /friend_requests/{requestId} {\n      allow read: if request.auth != null\n        && (request.auth.uid == resource.data.senderUid || request.auth.uid == resource.data.receiverUid);\n      allow create: if request.auth != null\n        && request.auth.uid == request.resource.data.senderUid\n        && isFriendRequestCreateDoc();\n      allow update: if isFriendRequestDecisionUpdate() || isFriendRequestRetryUpdate();\n      allow delete: if false;\n    }\n\n    match /friendships/{pairId} {\n      allow read: if request.auth != null && request.auth.uid in resource.data.users;\n      allow create: if isFriendshipDocCreate();\n      allow update, delete: if false;\n    }\n\n    match /userEmailLookup/{emailKey} {\n      allow get: if request.auth != null;\n      allow list: if false;\n      allow create, update: if request.auth != null\n        && request.resource.data.uid is string\n        && request.resource.data.uid == request.auth.uid\n        && request.resource.data.email is string\n        && request.resource.data.updatedAt is timestamp\n        && (!(\"displayName\" in request.resource.data)\n          || request.resource.data.displayName == null\n          || request.resource.data.displayName is string)\n        && (!(\"createdAt\" in request.resource.data)\n          || request.resource.data.createdAt is timestamp);\n      allow delete: if false;\n    }\n  }\n}\n\r\n","name":"firestore.rules"}]},"createTime":"2026-03-01T04:42:47.190015Z","metadata":{"services":["cloud.firestore"]}}
[debug] [2026-03-01T04:42:47.477Z] [rules] created ruleset projects/tasktimer-prod/rulesets/b12e25d5-68db-43ef-933f-63c41dd16b7c
[debug] [2026-03-01T04:42:47.478Z] [rules] releasing cloud.firestore/(default) with ruleset projects/tasktimer-prod/rulesets/b12e25d5-68db-43ef-933f-63c41dd16b7c
[debug] [2026-03-01T04:42:47.478Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:47.478Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:47.479Z] >>> [apiv2][query] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/(default) [none]
[debug] [2026-03-01T04:42:47.479Z] >>> [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/(default) {"release":{"name":"projects/tasktimer-prod/releases/cloud.firestore/(default)","rulesetName":"projects/tasktimer-prod/rulesets/b12e25d5-68db-43ef-933f-63c41dd16b7c"}}
[debug] [2026-03-01T04:42:48.012Z] <<< [apiv2][status] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/(default) 404
[debug] [2026-03-01T04:42:48.012Z] <<< [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/(default) {"error":{"code":404,"message":"Requested entity was not found.","status":"NOT_FOUND"}}
[debug] [2026-03-01T04:42:48.013Z] [rules] ruleset update failed, attempting to create instead
[debug] [2026-03-01T04:42:48.013Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:48.013Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:42:48.013Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases [none]
[debug] [2026-03-01T04:42:48.013Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases {"name":"projects/tasktimer-prod/releases/cloud.firestore/(default)","rulesetName":"projects/tasktimer-prod/rulesets/b12e25d5-68db-43ef-933f-63c41dd16b7c"}
[debug] [2026-03-01T04:42:49.517Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases 200
[debug] [2026-03-01T04:42:49.518Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases {"name":"projects/tasktimer-prod/releases/cloud.firestore","rulesetName":"projects/tasktimer-prod/rulesets/b12e25d5-68db-43ef-933f-63c41dd16b7c","createTime":"2026-03-01T04:42:49.242319Z","updateTime":"2026-03-01T04:42:49.242319Z"}
[debug] [2026-03-01T04:42:49.518Z] [rules] created release projects/tasktimer-prod/releases/cloud.firestore
[info] +  firestore: released rules firestore.rules to cloud.firestore 
[info] 
[info] +  Deploy complete! 
[info] 
[info] Project Console: https://console.firebase.google.com/project/tasktimer-prod/overview
[debug] [2026-03-01T04:54:44.588Z] ----------------------------------------------------------------------
[debug] [2026-03-01T04:54:44.593Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\anive\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js deploy --only firestore:rules --project tasktimer-prod
[debug] [2026-03-01T04:54:44.594Z] CLI Version:   15.8.0
[debug] [2026-03-01T04:54:44.594Z] Platform:      win32
[debug] [2026-03-01T04:54:44.594Z] Node Version:  v24.13.1
[debug] [2026-03-01T04:54:44.595Z] Time:          Sun Mar 01 2026 15:54:44 GMT+1100 (Australian Eastern Daylight Time)
[debug] [2026-03-01T04:54:44.595Z] ----------------------------------------------------------------------
[debug] 
[debug] [2026-03-01T04:54:48.543Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2026-03-01T04:54:48.544Z] > authorizing via signed-in user (aniven82@gmail.com)
[debug] [2026-03-01T04:54:48.544Z] [iam] checking project tasktimer-prod for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2026-03-01T04:54:48.545Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:54:48.546Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:54:48.547Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions [none]
[debug] [2026-03-01T04:54:48.547Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions  x-goog-user-project=tasktimer-prod
[debug] [2026-03-01T04:54:48.548Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2026-03-01T04:54:49.759Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions 200
[debug] [2026-03-01T04:54:49.760Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'tasktimer-prod'...
[info] 
[info] i  deploying firestore 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[debug] [2026-03-01T04:54:49.765Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:54:49.765Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:54:49.765Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase [none]
[debug] [2026-03-01T04:54:50.020Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase 200
[debug] [2026-03-01T04:54:50.021Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase {"name":"projects/tasktimer-prod/databases/timebase","uid":"dcd38a9d-dfb3-4ec0-9c47-3d395bdca42b","createTime":"2026-02-28T10:53:28.599115Z","updateTime":"2026-02-28T10:53:28.599115Z","locationId":"australia-southeast2","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2026-03-01T03:54:49.868315Z","appEngineIntegrationMode":"DISABLED","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":false,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"ILSspan0/ZIDMMv4p7iD/JID"}
[info] i  cloud.firestore: checking firestore.rules for compilation errors... 
[debug] [2026-03-01T04:54:50.022Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:54:50.022Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:54:50.023Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test [none]
[debug] [2026-03-01T04:54:50.023Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test [omitted]
[debug] [2026-03-01T04:54:51.790Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test 200
[debug] [2026-03-01T04:54:51.790Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test {}
[info] +  cloud.firestore: rules file firestore.rules compiled successfully 
[debug] [2026-03-01T04:54:51.792Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:54:51.792Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:54:51.793Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases pageSize=10&pageToken=
[debug] [2026-03-01T04:54:52.119Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases 200
[debug] [2026-03-01T04:54:52.119Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases {"releases":[{"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/f7eadc29-c2d6-4425-a226-19243e57d5ce","createTime":"2026-02-28T10:53:36.946559Z","updateTime":"2026-03-01T04:32:49.040351Z"},{"name":"projects/tasktimer-prod/releases/firebase.storage/tasktimer-prod.firebasestorage.app","rulesetName":"projects/tasktimer-prod/rulesets/ede5bb01-bb12-4bbb-8fcf-22ca8360ba5a","createTime":"2026-02-25T22:57:18.663407Z","updateTime":"2026-02-25T22:57:18.663407Z"}]}
[debug] [2026-03-01T04:54:52.135Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:54:52.135Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:54:52.135Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/f7eadc29-c2d6-4425-a226-19243e57d5ce [none]
[debug] [2026-03-01T04:54:52.460Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/f7eadc29-c2d6-4425-a226-19243e57d5ce 200
[debug] [2026-03-01T04:54:52.460Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/f7eadc29-c2d6-4425-a226-19243e57d5ce [omitted]
[info] i  firestore: uploading rules firestore.rules... 
[debug] [2026-03-01T04:54:52.462Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:54:52.462Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:54:52.462Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets [none]
[debug] [2026-03-01T04:54:52.462Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets [omitted]
[debug] [2026-03-01T04:54:53.197Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets 200
[debug] [2026-03-01T04:54:53.197Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets {"name":"projects/tasktimer-prod/rulesets/a6da29d6-1eef-44c2-b465-bad408fb78bf","source":{"files":[{"content":"rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    function isOwner(userId) {\n      return request.auth != null && request.auth.uid == userId;\n    }\n\n    function onlyKeys(allowed) {\n      return request.resource.data.keys().hasOnly(allowed);\n    }\n\n    function isUserDoc() {\n      return onlyKeys([\n        \"email\",\n        \"displayName\",\n        \"avatarId\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"schemaVersion\"\n      ])\n      && (!(\"email\" in request.resource.data) || request.resource.data.email is string)\n      && (!(\"displayName\" in request.resource.data) || request.resource.data.displayName == null || request.resource.data.displayName is string)\n      && (!(\"avatarId\" in request.resource.data) || request.resource.data.avatarId is string)\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int);\n    }\n\n    function isPreferencesV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"theme\",\n        \"defaultTaskTimerFormat\",\n        \"dynamicColorsEnabled\",\n        \"checkpointAlertSoundEnabled\",\n        \"checkpointAlertToastEnabled\",\n        \"modeSettings\",\n        \"updatedAtMs\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"theme\" in request.resource.data) || request.resource.data.theme in [\"light\", \"dark\"])\n      && (!(\"defaultTaskTimerFormat\" in request.resource.data) || request.resource.data.defaultTaskTimerFormat in [\"day\", \"hour\", \"minute\"])\n      && (!(\"dynamicColorsEnabled\" in request.resource.data) || request.resource.data.dynamicColorsEnabled is bool)\n      && (!(\"checkpointAlertSoundEnabled\" in request.resource.data) || request.resource.data.checkpointAlertSoundEnabled is bool)\n      && (!(\"checkpointAlertToastEnabled\" in request.resource.data) || request.resource.data.checkpointAlertToastEnabled is bool)\n      && (!(\"modeSettings\" in request.resource.data) || request.resource.data.modeSettings == null || request.resource.data.modeSettings is map)\n      && (!(\"updatedAtMs\" in request.resource.data) || request.resource.data.updatedAtMs is int)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isDashboardV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"order\",\n        \"widgets\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"order\" in request.resource.data) || request.resource.data.order is list)\n      && (!(\"widgets\" in request.resource.data) || request.resource.data.widgets is map)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isTaskUiV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"historyRangeDaysByTaskId\",\n        \"historyRangeModeByTaskId\",\n        \"pinnedHistoryTaskIds\",\n        \"customTaskNames\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"historyRangeDaysByTaskId\" in request.resource.data) || request.resource.data.historyRangeDaysByTaskId is map)\n      && (!(\"historyRangeModeByTaskId\" in request.resource.data) || request.resource.data.historyRangeModeByTaskId is map)\n      && (!(\"pinnedHistoryTaskIds\" in request.resource.data) || request.resource.data.pinnedHistoryTaskIds is list)\n      && (!(\"customTaskNames\" in request.resource.data) || request.resource.data.customTaskNames is list)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isAccountStateV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"friendInviteKey\",\n        \"friendInviteKeyExpiresAt\",\n        \"deleteReauthPending\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"friendInviteKey\" in request.resource.data) || request.resource.data.friendInviteKey == null || request.resource.data.friendInviteKey is string)\n      && (!(\"friendInviteKeyExpiresAt\" in request.resource.data) || request.resource.data.friendInviteKeyExpiresAt == null || request.resource.data.friendInviteKeyExpiresAt is int)\n      && (!(\"deleteReauthPending\" in request.resource.data) || request.resource.data.deleteReauthPending is bool)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isTaskDoc() {\n      return onlyKeys([\n        \"id\",\n        \"name\",\n        \"order\",\n        \"collapsed\",\n        \"color\",\n        \"accumulatedMs\",\n        \"running\",\n        \"startMs\",\n        \"hasStarted\",\n        \"checkpointsEnabled\",\n        \"checkpointTimeUnit\",\n        \"checkpoints\",\n        \"checkpointSoundEnabled\",\n        \"checkpointSoundMode\",\n        \"checkpointToastEnabled\",\n        \"checkpointToastMode\",\n        \"finalCheckpointAction\",\n        \"presetIntervalsEnabled\",\n        \"presetIntervalValue\",\n        \"presetIntervalLastCheckpointId\",\n        \"presetIntervalNextSeq\",\n        \"mode\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"schemaVersion\"\n      ])\n      && (!(\"id\" in request.resource.data) || request.resource.data.id is string)\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"order\" in request.resource.data) || request.resource.data.order is int)\n      && (!(\"collapsed\" in request.resource.data) || request.resource.data.collapsed is bool)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"accumulatedMs\" in request.resource.data) || request.resource.data.accumulatedMs is int)\n      && (!(\"running\" in request.resource.data) || request.resource.data.running is bool)\n      && (!(\"startMs\" in request.resource.data) || request.resource.data.startMs == null || request.resource.data.startMs is int)\n      && (!(\"hasStarted\" in request.resource.data) || request.resource.data.hasStarted is bool)\n      && (!(\"checkpointsEnabled\" in request.resource.data) || request.resource.data.checkpointsEnabled is bool)\n      && (!(\"checkpointTimeUnit\" in request.resource.data) || request.resource.data.checkpointTimeUnit in [\"day\", \"hour\", \"minute\"])\n      && (!(\"checkpoints\" in request.resource.data) || request.resource.data.checkpoints is list)\n      && (!(\"checkpointSoundEnabled\" in request.resource.data) || request.resource.data.checkpointSoundEnabled is bool)\n      && (!(\"checkpointSoundMode\" in request.resource.data) || request.resource.data.checkpointSoundMode in [\"once\", \"repeat\"])\n      && (!(\"checkpointToastEnabled\" in request.resource.data) || request.resource.data.checkpointToastEnabled is bool)\n      && (!(\"checkpointToastMode\" in request.resource.data) || request.resource.data.checkpointToastMode in [\"auto5s\", \"manual\"])\n      && (!(\"finalCheckpointAction\" in request.resource.data) || request.resource.data.finalCheckpointAction in [\"continue\", \"resetLog\", \"resetNoLog\"])\n      && (!(\"presetIntervalsEnabled\" in request.resource.data) || request.resource.data.presetIntervalsEnabled is bool)\n      && (!(\"presetIntervalValue\" in request.resource.data) || request.resource.data.presetIntervalValue is int || request.resource.data.presetIntervalValue is float)\n      && (!(\"presetIntervalLastCheckpointId\" in request.resource.data) || request.resource.data.presetIntervalLastCheckpointId == null || request.resource.data.presetIntervalLastCheckpointId is string)\n      && (!(\"presetIntervalNextSeq\" in request.resource.data) || request.resource.data.presetIntervalNextSeq is int)\n      && (!(\"mode\" in request.resource.data) || request.resource.data.mode in [\"mode1\", \"mode2\", \"mode3\"])\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int);\n    }\n\n    function isHistoryDoc() {\n      return onlyKeys([\n        \"ts\",\n        \"name\",\n        \"ms\",\n        \"color\",\n        \"createdAt\"\n      ])\n      && (!(\"ts\" in request.resource.data) || request.resource.data.ts is int)\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"ms\" in request.resource.data) || request.resource.data.ms is int)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp);\n    }\n\n    function isDeletedTaskDoc() {\n      return onlyKeys([\n        \"name\",\n        \"color\",\n        \"deletedAt\",\n        \"updatedAt\"\n      ])\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"deletedAt\" in request.resource.data) || request.resource.data.deletedAt is int)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isFriendRequestDocShape() {\n      return onlyKeys([\n        \"requestId\",\n        \"senderUid\",\n        \"receiverUid\",\n        \"senderEmail\",\n        \"receiverEmail\",\n        \"status\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"respondedAt\",\n        \"respondedBy\"\n      ])\n      && (!(\"requestId\" in request.resource.data) || request.resource.data.requestId is string)\n      && (!(\"senderUid\" in request.resource.data) || request.resource.data.senderUid is string)\n      && (!(\"receiverUid\" in request.resource.data) || request.resource.data.receiverUid is string)\n      && (!(\"senderEmail\" in request.resource.data) || request.resource.data.senderEmail == null || request.resource.data.senderEmail is string)\n      && (!(\"receiverEmail\" in request.resource.data) || request.resource.data.receiverEmail == null || request.resource.data.receiverEmail is string)\n      && (!(\"status\" in request.resource.data) || request.resource.data.status in [\"pending\", \"approved\", \"declined\"])\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"respondedAt\" in request.resource.data) || request.resource.data.respondedAt == null || request.resource.data.respondedAt is timestamp)\n      && (!(\"respondedBy\" in request.resource.data) || request.resource.data.respondedBy == null || request.resource.data.respondedBy is string);\n    }\n\n    function isFriendRequestCreateDoc() {\n      return isFriendRequestDocShape()\n      && request.resource.data.keys().hasAll([\n        \"requestId\",\n        \"senderUid\",\n        \"receiverUid\",\n        \"status\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"respondedAt\",\n        \"respondedBy\"\n      ])\n      && request.resource.data.requestId == (\"pending:\" + request.resource.data.senderUid + \":\" + request.resource.data.receiverUid)\n      && request.resource.data.status == \"pending\"\n      && request.resource.data.senderUid != request.resource.data.receiverUid\n      && request.resource.data.respondedAt == null\n      && request.resource.data.respondedBy == null;\n    }\n\n    function isFriendRequestDecisionUpdate() {\n      return isFriendRequestDocShape()\n      && request.auth != null\n      && request.auth.uid == resource.data.receiverUid\n      && resource.data.status == \"pending\"\n      && request.resource.data.status in [\"approved\", \"declined\"]\n      && request.resource.data.requestId == resource.data.requestId\n      && request.resource.data.senderUid == resource.data.senderUid\n      && request.resource.data.receiverUid == resource.data.receiverUid\n      && request.resource.data.createdAt == resource.data.createdAt\n      && request.resource.data.respondedBy == request.auth.uid\n      && request.resource.data.respondedAt is timestamp;\n    }\n\n    function isFriendRequestRetryUpdate() {\n      return isFriendRequestDocShape()\n      && request.auth != null\n      && request.auth.uid == resource.data.senderUid\n      && resource.data.status in [\"approved\", \"declined\"]\n      && request.resource.data.status == \"pending\"\n      && request.resource.data.requestId == resource.data.requestId\n      && request.resource.data.senderUid == resource.data.senderUid\n      && request.resource.data.receiverUid == resource.data.receiverUid\n      && request.resource.data.createdAt == resource.data.createdAt\n      && request.resource.data.respondedBy == null\n      && request.resource.data.respondedAt == null;\n    }\n\n    function isFriendshipDocCreate() {\n      return onlyKeys([\n        \"pairId\",\n        \"users\",\n        \"createdAt\",\n        \"createdBy\"\n      ])\n      && request.resource.data.keys().hasAll([\n        \"pairId\",\n        \"users\",\n        \"createdAt\",\n        \"createdBy\"\n      ])\n      && request.auth != null\n      && request.resource.data.pairId is string\n      && request.resource.data.users is list\n      && request.resource.data.users.size() == 2\n      && request.resource.data.users[0] is string\n      && request.resource.data.users[1] is string\n      && request.resource.data.users[0] != request.resource.data.users[1]\n      && request.auth.uid in request.resource.data.users\n      && request.resource.data.createdAt is timestamp\n      && request.resource.data.createdBy is string\n      && (\n        (\n          request.resource.data.users[0] < request.resource.data.users[1]\n          && request.resource.data.pairId == (\"pair:\" + request.resource.data.users[0] + \":\" + request.resource.data.users[1])\n        )\n        || (\n          request.resource.data.users[1] < request.resource.data.users[0]\n          && request.resource.data.pairId == (\"pair:\" + request.resource.data.users[1] + \":\" + request.resource.data.users[0])\n        )\n      );\n    }\n\n    match /users/{userId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isUserDoc();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/preferences/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isPreferencesV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/dashboard/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isDashboardV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/taskUi/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isTaskUiV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/accountState/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isAccountStateV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/tasks/{taskId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isTaskDoc();\n      allow delete: if isOwner(userId);\n\n      match /history/{entryId} {\n        allow read: if isOwner(userId);\n        allow create, update: if isOwner(userId) && isHistoryDoc();\n        allow delete: if isOwner(userId);\n      }\n    }\n\n    match /users/{userId}/deletedTasks/{taskId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isDeletedTaskDoc();\n      allow delete: if isOwner(userId);\n    }\n\n    match /friend_requests/{requestId} {\n      allow read: if request.auth != null\n        && (request.auth.uid == resource.data.senderUid || request.auth.uid == resource.data.receiverUid);\n      allow create: if request.auth != null\n        && request.auth.uid == request.resource.data.senderUid\n        && isFriendRequestCreateDoc();\n      allow update: if isFriendRequestDecisionUpdate() || isFriendRequestRetryUpdate();\n      allow delete: if false;\n    }\n\n    match /friendships/{pairId} {\n      allow read: if request.auth != null && request.auth.uid in resource.data.users;\n      allow create: if isFriendshipDocCreate();\n      allow update, delete: if false;\n    }\n\n    match /userEmailLookup/{emailKey} {\n      allow get: if request.auth != null;\n      allow list: if false;\n      allow create, update: if request.auth != null\n        && request.resource.data.uid is string\n        && request.resource.data.uid == request.auth.uid\n        && request.resource.data.email is string\n        && request.resource.data.updatedAt is timestamp\n        && (!(\"displayName\" in request.resource.data)\n          || request.resource.data.displayName == null\n          || request.resource.data.displayName is string)\n        && (!(\"createdAt\" in request.resource.data)\n          || request.resource.data.createdAt is timestamp);\n      allow delete: if false;\n    }\n  }\n}\n\r\n","name":"firestore.rules"}]},"createTime":"2026-03-01T04:54:52.910223Z","metadata":{"services":["cloud.firestore"]}}
[debug] [2026-03-01T04:54:53.198Z] [rules] created ruleset projects/tasktimer-prod/rulesets/a6da29d6-1eef-44c2-b465-bad408fb78bf
[debug] [2026-03-01T04:54:53.198Z] [rules] releasing cloud.firestore/timebase with ruleset projects/tasktimer-prod/rulesets/a6da29d6-1eef-44c2-b465-bad408fb78bf
[debug] [2026-03-01T04:54:53.199Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:54:53.199Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T04:54:53.199Z] >>> [apiv2][query] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase [none]
[debug] [2026-03-01T04:54:53.200Z] >>> [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase {"release":{"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/a6da29d6-1eef-44c2-b465-bad408fb78bf"}}
[debug] [2026-03-01T04:54:54.681Z] <<< [apiv2][status] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase 200
[debug] [2026-03-01T04:54:54.681Z] <<< [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase {"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/a6da29d6-1eef-44c2-b465-bad408fb78bf","createTime":"2026-02-28T10:53:36.946559Z","updateTime":"2026-03-01T04:54:54.366367Z"}
[debug] [2026-03-01T04:54:54.682Z] [rules] updated release projects/tasktimer-prod/releases/cloud.firestore/timebase
[info] +  firestore: released rules firestore.rules to cloud.firestore 
[info] 
[info] +  Deploy complete! 
[info] 
[info] Project Console: https://console.firebase.google.com/project/tasktimer-prod/overview
[debug] [2026-03-01T05:02:54.931Z] ----------------------------------------------------------------------
[debug] [2026-03-01T05:02:54.935Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\anive\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js deploy --only firestore:rules --project tasktimer-prod
[debug] [2026-03-01T05:02:54.936Z] CLI Version:   15.8.0
[debug] [2026-03-01T05:02:54.936Z] Platform:      win32
[debug] [2026-03-01T05:02:54.936Z] Node Version:  v24.13.1
[debug] [2026-03-01T05:02:54.936Z] Time:          Sun Mar 01 2026 16:02:54 GMT+1100 (Australian Eastern Daylight Time)
[debug] [2026-03-01T05:02:54.936Z] ----------------------------------------------------------------------
[debug] 
[debug] [2026-03-01T05:02:58.644Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2026-03-01T05:02:58.645Z] > authorizing via signed-in user (aniven82@gmail.com)
[debug] [2026-03-01T05:02:58.645Z] [iam] checking project tasktimer-prod for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2026-03-01T05:02:58.647Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:02:58.647Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:02:58.649Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions [none]
[debug] [2026-03-01T05:02:58.649Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions  x-goog-user-project=tasktimer-prod
[debug] [2026-03-01T05:02:58.649Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2026-03-01T05:02:59.796Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions 200
[debug] [2026-03-01T05:02:59.797Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'tasktimer-prod'...
[info] 
[info] i  deploying firestore 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[debug] [2026-03-01T05:02:59.801Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:02:59.801Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:02:59.801Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase [none]
[debug] [2026-03-01T05:03:00.042Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase 200
[debug] [2026-03-01T05:03:00.042Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase {"name":"projects/tasktimer-prod/databases/timebase","uid":"dcd38a9d-dfb3-4ec0-9c47-3d395bdca42b","createTime":"2026-02-28T10:53:28.599115Z","updateTime":"2026-02-28T10:53:28.599115Z","locationId":"australia-southeast2","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2026-03-01T04:02:59.896338Z","appEngineIntegrationMode":"DISABLED","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":false,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"II6l+pL2/ZIDMMv4p7iD/JID"}
[info] i  cloud.firestore: checking firestore.rules for compilation errors... 
[debug] [2026-03-01T05:03:00.043Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:03:00.043Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:03:00.043Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test [none]
[debug] [2026-03-01T05:03:00.044Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test [omitted]
[debug] [2026-03-01T05:03:01.753Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test 200
[debug] [2026-03-01T05:03:01.754Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test {}
[info] +  cloud.firestore: rules file firestore.rules compiled successfully 
[debug] [2026-03-01T05:03:01.756Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:03:01.756Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:03:01.756Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases pageSize=10&pageToken=
[debug] [2026-03-01T05:03:03.086Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases 200
[debug] [2026-03-01T05:03:03.086Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases {"releases":[{"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/a6da29d6-1eef-44c2-b465-bad408fb78bf","createTime":"2026-02-28T10:53:36.946559Z","updateTime":"2026-03-01T04:54:54.366367Z"},{"name":"projects/tasktimer-prod/releases/firebase.storage/tasktimer-prod.firebasestorage.app","rulesetName":"projects/tasktimer-prod/rulesets/ede5bb01-bb12-4bbb-8fcf-22ca8360ba5a","createTime":"2026-02-25T22:57:18.663407Z","updateTime":"2026-02-25T22:57:18.663407Z"}]}
[debug] [2026-03-01T05:03:03.104Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:03:03.104Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:03:03.104Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/a6da29d6-1eef-44c2-b465-bad408fb78bf [none]
[debug] [2026-03-01T05:03:03.642Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/a6da29d6-1eef-44c2-b465-bad408fb78bf 200
[debug] [2026-03-01T05:03:03.643Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/a6da29d6-1eef-44c2-b465-bad408fb78bf [omitted]
[info] i  firestore: uploading rules firestore.rules... 
[debug] [2026-03-01T05:03:03.644Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:03:03.644Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:03:03.644Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets [none]
[debug] [2026-03-01T05:03:03.645Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets [omitted]
[debug] [2026-03-01T05:03:05.229Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets 200
[debug] [2026-03-01T05:03:05.230Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets {"name":"projects/tasktimer-prod/rulesets/28338c91-3ab2-495a-b66d-ee1c958ac6e4","source":{"files":[{"content":"rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    function isOwner(userId) {\n      return request.auth != null && request.auth.uid == userId;\n    }\n\n    function onlyKeys(allowed) {\n      return request.resource.data.keys().hasOnly(allowed);\n    }\n\n    function isUserDoc() {\n      return onlyKeys([\n        \"email\",\n        \"displayName\",\n        \"avatarId\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"schemaVersion\"\n      ])\n      && (!(\"email\" in request.resource.data) || request.resource.data.email is string)\n      && (!(\"displayName\" in request.resource.data) || request.resource.data.displayName == null || request.resource.data.displayName is string)\n      && (!(\"avatarId\" in request.resource.data) || request.resource.data.avatarId is string)\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int);\n    }\n\n    function isPreferencesV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"theme\",\n        \"defaultTaskTimerFormat\",\n        \"dynamicColorsEnabled\",\n        \"checkpointAlertSoundEnabled\",\n        \"checkpointAlertToastEnabled\",\n        \"modeSettings\",\n        \"updatedAtMs\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"theme\" in request.resource.data) || request.resource.data.theme in [\"light\", \"dark\"])\n      && (!(\"defaultTaskTimerFormat\" in request.resource.data) || request.resource.data.defaultTaskTimerFormat in [\"day\", \"hour\", \"minute\"])\n      && (!(\"dynamicColorsEnabled\" in request.resource.data) || request.resource.data.dynamicColorsEnabled is bool)\n      && (!(\"checkpointAlertSoundEnabled\" in request.resource.data) || request.resource.data.checkpointAlertSoundEnabled is bool)\n      && (!(\"checkpointAlertToastEnabled\" in request.resource.data) || request.resource.data.checkpointAlertToastEnabled is bool)\n      && (!(\"modeSettings\" in request.resource.data) || request.resource.data.modeSettings == null || request.resource.data.modeSettings is map)\n      && (!(\"updatedAtMs\" in request.resource.data) || request.resource.data.updatedAtMs is int)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isDashboardV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"order\",\n        \"widgets\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"order\" in request.resource.data) || request.resource.data.order is list)\n      && (!(\"widgets\" in request.resource.data) || request.resource.data.widgets is map)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isTaskUiV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"historyRangeDaysByTaskId\",\n        \"historyRangeModeByTaskId\",\n        \"pinnedHistoryTaskIds\",\n        \"customTaskNames\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"historyRangeDaysByTaskId\" in request.resource.data) || request.resource.data.historyRangeDaysByTaskId is map)\n      && (!(\"historyRangeModeByTaskId\" in request.resource.data) || request.resource.data.historyRangeModeByTaskId is map)\n      && (!(\"pinnedHistoryTaskIds\" in request.resource.data) || request.resource.data.pinnedHistoryTaskIds is list)\n      && (!(\"customTaskNames\" in request.resource.data) || request.resource.data.customTaskNames is list)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isAccountStateV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"friendInviteKey\",\n        \"friendInviteKeyExpiresAt\",\n        \"deleteReauthPending\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"friendInviteKey\" in request.resource.data) || request.resource.data.friendInviteKey == null || request.resource.data.friendInviteKey is string)\n      && (!(\"friendInviteKeyExpiresAt\" in request.resource.data) || request.resource.data.friendInviteKeyExpiresAt == null || request.resource.data.friendInviteKeyExpiresAt is int)\n      && (!(\"deleteReauthPending\" in request.resource.data) || request.resource.data.deleteReauthPending is bool)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isTaskDoc() {\n      return onlyKeys([\n        \"id\",\n        \"name\",\n        \"order\",\n        \"collapsed\",\n        \"color\",\n        \"accumulatedMs\",\n        \"running\",\n        \"startMs\",\n        \"hasStarted\",\n        \"checkpointsEnabled\",\n        \"checkpointTimeUnit\",\n        \"checkpoints\",\n        \"checkpointSoundEnabled\",\n        \"checkpointSoundMode\",\n        \"checkpointToastEnabled\",\n        \"checkpointToastMode\",\n        \"finalCheckpointAction\",\n        \"presetIntervalsEnabled\",\n        \"presetIntervalValue\",\n        \"presetIntervalLastCheckpointId\",\n        \"presetIntervalNextSeq\",\n        \"mode\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"schemaVersion\"\n      ])\n      && (!(\"id\" in request.resource.data) || request.resource.data.id is string)\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"order\" in request.resource.data) || request.resource.data.order is int)\n      && (!(\"collapsed\" in request.resource.data) || request.resource.data.collapsed is bool)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"accumulatedMs\" in request.resource.data) || request.resource.data.accumulatedMs is int)\n      && (!(\"running\" in request.resource.data) || request.resource.data.running is bool)\n      && (!(\"startMs\" in request.resource.data) || request.resource.data.startMs == null || request.resource.data.startMs is int)\n      && (!(\"hasStarted\" in request.resource.data) || request.resource.data.hasStarted is bool)\n      && (!(\"checkpointsEnabled\" in request.resource.data) || request.resource.data.checkpointsEnabled is bool)\n      && (!(\"checkpointTimeUnit\" in request.resource.data) || request.resource.data.checkpointTimeUnit in [\"day\", \"hour\", \"minute\"])\n      && (!(\"checkpoints\" in request.resource.data) || request.resource.data.checkpoints is list)\n      && (!(\"checkpointSoundEnabled\" in request.resource.data) || request.resource.data.checkpointSoundEnabled is bool)\n      && (!(\"checkpointSoundMode\" in request.resource.data) || request.resource.data.checkpointSoundMode in [\"once\", \"repeat\"])\n      && (!(\"checkpointToastEnabled\" in request.resource.data) || request.resource.data.checkpointToastEnabled is bool)\n      && (!(\"checkpointToastMode\" in request.resource.data) || request.resource.data.checkpointToastMode in [\"auto5s\", \"manual\"])\n      && (!(\"finalCheckpointAction\" in request.resource.data) || request.resource.data.finalCheckpointAction in [\"continue\", \"resetLog\", \"resetNoLog\"])\n      && (!(\"presetIntervalsEnabled\" in request.resource.data) || request.resource.data.presetIntervalsEnabled is bool)\n      && (!(\"presetIntervalValue\" in request.resource.data) || request.resource.data.presetIntervalValue is int || request.resource.data.presetIntervalValue is float)\n      && (!(\"presetIntervalLastCheckpointId\" in request.resource.data) || request.resource.data.presetIntervalLastCheckpointId == null || request.resource.data.presetIntervalLastCheckpointId is string)\n      && (!(\"presetIntervalNextSeq\" in request.resource.data) || request.resource.data.presetIntervalNextSeq is int)\n      && (!(\"mode\" in request.resource.data) || request.resource.data.mode in [\"mode1\", \"mode2\", \"mode3\"])\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int);\n    }\n\n    function isHistoryDoc() {\n      return onlyKeys([\n        \"ts\",\n        \"name\",\n        \"ms\",\n        \"color\",\n        \"createdAt\"\n      ])\n      && (!(\"ts\" in request.resource.data) || request.resource.data.ts is int)\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"ms\" in request.resource.data) || request.resource.data.ms is int)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp);\n    }\n\n    function isDeletedTaskDoc() {\n      return onlyKeys([\n        \"name\",\n        \"color\",\n        \"deletedAt\",\n        \"updatedAt\"\n      ])\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"deletedAt\" in request.resource.data) || request.resource.data.deletedAt is int)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isFriendRequestDocShape() {\n      return onlyKeys([\n        \"requestId\",\n        \"senderUid\",\n        \"receiverUid\",\n        \"senderEmail\",\n        \"receiverEmail\",\n        \"status\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"respondedAt\",\n        \"respondedBy\"\n      ])\n      && (!(\"requestId\" in request.resource.data) || request.resource.data.requestId is string)\n      && (!(\"senderUid\" in request.resource.data) || request.resource.data.senderUid is string)\n      && (!(\"receiverUid\" in request.resource.data) || request.resource.data.receiverUid is string)\n      && (!(\"senderEmail\" in request.resource.data) || request.resource.data.senderEmail == null || request.resource.data.senderEmail is string)\n      && (!(\"receiverEmail\" in request.resource.data) || request.resource.data.receiverEmail == null || request.resource.data.receiverEmail is string)\n      && (!(\"status\" in request.resource.data) || request.resource.data.status in [\"pending\", \"approved\", \"declined\"])\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt != null)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt != null)\n      && (!(\"respondedAt\" in request.resource.data) || request.resource.data.respondedAt == null || request.resource.data.respondedAt != null)\n      && (!(\"respondedBy\" in request.resource.data) || request.resource.data.respondedBy == null || request.resource.data.respondedBy is string);\n    }\n\n    function isFriendRequestCreateDoc() {\n      return isFriendRequestDocShape()\n      && request.resource.data.keys().hasAll([\n        \"requestId\",\n        \"senderUid\",\n        \"receiverUid\",\n        \"status\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"respondedAt\",\n        \"respondedBy\"\n      ])\n      && request.resource.data.requestId == (\"pending:\" + request.resource.data.senderUid + \":\" + request.resource.data.receiverUid)\n      && request.resource.data.status == \"pending\"\n      && request.resource.data.senderUid != request.resource.data.receiverUid\n      && request.resource.data.respondedAt == null\n      && request.resource.data.respondedBy == null;\n    }\n\n    function isFriendRequestDecisionUpdate() {\n      return isFriendRequestDocShape()\n      && request.auth != null\n      && request.auth.uid == resource.data.receiverUid\n      && resource.data.status == \"pending\"\n      && request.resource.data.status in [\"approved\", \"declined\"]\n      && request.resource.data.requestId == resource.data.requestId\n      && request.resource.data.senderUid == resource.data.senderUid\n      && request.resource.data.receiverUid == resource.data.receiverUid\n      && request.resource.data.createdAt == resource.data.createdAt\n      && request.resource.data.respondedBy == request.auth.uid\n      && request.resource.data.respondedAt is timestamp;\n    }\n\n    function isFriendRequestRetryUpdate() {\n      return isFriendRequestDocShape()\n      && request.auth != null\n      && request.auth.uid == resource.data.senderUid\n      && resource.data.status in [\"approved\", \"declined\"]\n      && request.resource.data.status == \"pending\"\n      && request.resource.data.requestId == resource.data.requestId\n      && request.resource.data.senderUid == resource.data.senderUid\n      && request.resource.data.receiverUid == resource.data.receiverUid\n      && request.resource.data.createdAt == resource.data.createdAt\n      && request.resource.data.respondedBy == null\n      && request.resource.data.respondedAt == null;\n    }\n\n    function isFriendshipDocCreate() {\n      return onlyKeys([\n        \"pairId\",\n        \"users\",\n        \"createdAt\",\n        \"createdBy\"\n      ])\n      && request.resource.data.keys().hasAll([\n        \"pairId\",\n        \"users\",\n        \"createdAt\",\n        \"createdBy\"\n      ])\n      && request.auth != null\n      && request.resource.data.pairId is string\n      && request.resource.data.users is list\n      && request.resource.data.users.size() == 2\n      && request.resource.data.users[0] is string\n      && request.resource.data.users[1] is string\n      && request.resource.data.users[0] != request.resource.data.users[1]\n      && request.auth.uid in request.resource.data.users\n      && request.resource.data.createdAt is timestamp\n      && request.resource.data.createdBy is string\n      && (\n        (\n          request.resource.data.users[0] < request.resource.data.users[1]\n          && request.resource.data.pairId == (\"pair:\" + request.resource.data.users[0] + \":\" + request.resource.data.users[1])\n        )\n        || (\n          request.resource.data.users[1] < request.resource.data.users[0]\n          && request.resource.data.pairId == (\"pair:\" + request.resource.data.users[1] + \":\" + request.resource.data.users[0])\n        )\n      );\n    }\n\n    match /users/{userId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isUserDoc();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/preferences/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isPreferencesV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/dashboard/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isDashboardV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/taskUi/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isTaskUiV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/accountState/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isAccountStateV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/tasks/{taskId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isTaskDoc();\n      allow delete: if isOwner(userId);\n\n      match /history/{entryId} {\n        allow read: if isOwner(userId);\n        allow create, update: if isOwner(userId) && isHistoryDoc();\n        allow delete: if isOwner(userId);\n      }\n    }\n\n    match /users/{userId}/deletedTasks/{taskId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isDeletedTaskDoc();\n      allow delete: if isOwner(userId);\n    }\n\n    match /friend_requests/{requestId} {\n      allow read: if request.auth != null\n        && (request.auth.uid == resource.data.senderUid || request.auth.uid == resource.data.receiverUid);\n      allow create: if request.auth != null\n        && request.auth.uid == request.resource.data.senderUid\n        && isFriendRequestCreateDoc();\n      allow update: if isFriendRequestDecisionUpdate() || isFriendRequestRetryUpdate();\n      allow delete: if false;\n    }\n\n    match /friendships/{pairId} {\n      allow read: if request.auth != null && request.auth.uid in resource.data.users;\n      allow create: if isFriendshipDocCreate();\n      allow update, delete: if false;\n    }\n\n    match /userEmailLookup/{emailKey} {\n      allow read: if request.auth != null;\n      allow create, update: if request.auth != null\n        && request.resource.data.uid is string\n        && request.resource.data.uid == request.auth.uid\n        && request.resource.data.email is string\n        && (!(\"displayName\" in request.resource.data)\n          || request.resource.data.displayName == null\n          || request.resource.data.displayName is string)\n        && (!(\"createdAt\" in request.resource.data)\n          || request.resource.data.createdAt != null)\n        && (!(\"updatedAt\" in request.resource.data)\n          || request.resource.data.updatedAt != null);\n      allow delete: if false;\n    }\n  }\n}\n\r\n","name":"firestore.rules"}]},"createTime":"2026-03-01T05:03:04.936287Z","metadata":{"services":["cloud.firestore"]}}
[debug] [2026-03-01T05:03:05.230Z] [rules] created ruleset projects/tasktimer-prod/rulesets/28338c91-3ab2-495a-b66d-ee1c958ac6e4
[debug] [2026-03-01T05:03:05.231Z] [rules] releasing cloud.firestore/timebase with ruleset projects/tasktimer-prod/rulesets/28338c91-3ab2-495a-b66d-ee1c958ac6e4
[debug] [2026-03-01T05:03:05.231Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:03:05.231Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:03:05.232Z] >>> [apiv2][query] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase [none]
[debug] [2026-03-01T05:03:05.232Z] >>> [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase {"release":{"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/28338c91-3ab2-495a-b66d-ee1c958ac6e4"}}
[debug] [2026-03-01T05:03:06.750Z] <<< [apiv2][status] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase 200
[debug] [2026-03-01T05:03:06.750Z] <<< [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase {"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/28338c91-3ab2-495a-b66d-ee1c958ac6e4","createTime":"2026-02-28T10:53:36.946559Z","updateTime":"2026-03-01T05:03:06.462031Z"}
[debug] [2026-03-01T05:03:06.751Z] [rules] updated release projects/tasktimer-prod/releases/cloud.firestore/timebase
[info] +  firestore: released rules firestore.rules to cloud.firestore 
[info] 
[info] +  Deploy complete! 
[info] 
[info] Project Console: https://console.firebase.google.com/project/tasktimer-prod/overview
[debug] [2026-03-01T05:12:10.274Z] ----------------------------------------------------------------------
[debug] [2026-03-01T05:12:10.278Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\anive\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js deploy --only firestore:rules
[debug] [2026-03-01T05:12:10.279Z] CLI Version:   15.8.0
[debug] [2026-03-01T05:12:10.279Z] Platform:      win32
[debug] [2026-03-01T05:12:10.279Z] Node Version:  v24.13.1
[debug] [2026-03-01T05:12:10.279Z] Time:          Sun Mar 01 2026 16:12:10 GMT+1100 (Australian Eastern Daylight Time)
[debug] [2026-03-01T05:12:10.279Z] ----------------------------------------------------------------------
[debug] 
[debug] [2026-03-01T05:12:13.872Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2026-03-01T05:12:13.873Z] > authorizing via signed-in user (aniven82@gmail.com)
[debug] [2026-03-01T05:12:13.873Z] [iam] checking project tasktimer-prod for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2026-03-01T05:12:13.875Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:12:13.875Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:12:13.877Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions [none]
[debug] [2026-03-01T05:12:13.877Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions  x-goog-user-project=tasktimer-prod
[debug] [2026-03-01T05:12:13.877Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2026-03-01T05:12:15.008Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions 200
[debug] [2026-03-01T05:12:15.009Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'tasktimer-prod'...
[info] 
[info] i  deploying firestore 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[debug] [2026-03-01T05:12:15.014Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:12:15.014Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:12:15.014Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase [none]
[debug] [2026-03-01T05:12:15.262Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase 200
[debug] [2026-03-01T05:12:15.262Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase {"name":"projects/tasktimer-prod/databases/timebase","uid":"dcd38a9d-dfb3-4ec0-9c47-3d395bdca42b","createTime":"2026-02-28T10:53:28.599115Z","updateTime":"2026-02-28T10:53:28.599115Z","locationId":"australia-southeast2","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2026-03-01T04:12:15.110995Z","appEngineIntegrationMode":"DISABLED","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":false,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"IIXy2Zv4/ZIDMMv4p7iD/JID"}
[info] i  cloud.firestore: checking firestore.rules for compilation errors... 
[debug] [2026-03-01T05:12:15.264Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:12:15.264Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:12:15.264Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test [none]
[debug] [2026-03-01T05:12:15.264Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test [omitted]
[debug] [2026-03-01T05:12:16.943Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test 200
[debug] [2026-03-01T05:12:16.944Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test {}
[info] +  cloud.firestore: rules file firestore.rules compiled successfully 
[debug] [2026-03-01T05:12:16.946Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:12:16.946Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:12:16.946Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases pageSize=10&pageToken=
[debug] [2026-03-01T05:12:18.305Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases 200
[debug] [2026-03-01T05:12:18.305Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases {"releases":[{"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/94a39d98-4a1c-48be-8233-02974fb17c0e","createTime":"2026-02-28T10:53:36.946559Z","updateTime":"2026-03-01T05:05:15.487455Z"},{"name":"projects/tasktimer-prod/releases/firebase.storage/tasktimer-prod.firebasestorage.app","rulesetName":"projects/tasktimer-prod/rulesets/ede5bb01-bb12-4bbb-8fcf-22ca8360ba5a","createTime":"2026-02-25T22:57:18.663407Z","updateTime":"2026-02-25T22:57:18.663407Z"}]}
[debug] [2026-03-01T05:12:18.321Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:12:18.321Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:12:18.321Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/94a39d98-4a1c-48be-8233-02974fb17c0e [none]
[debug] [2026-03-01T05:12:18.834Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/94a39d98-4a1c-48be-8233-02974fb17c0e 200
[debug] [2026-03-01T05:12:18.834Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/94a39d98-4a1c-48be-8233-02974fb17c0e [omitted]
[info] i  firestore: uploading rules firestore.rules... 
[debug] [2026-03-01T05:12:18.836Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:12:18.836Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:12:18.837Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets [none]
[debug] [2026-03-01T05:12:18.837Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets [omitted]
[debug] [2026-03-01T05:12:20.369Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets 200
[debug] [2026-03-01T05:12:20.370Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets {"name":"projects/tasktimer-prod/rulesets/ba6c38f3-b163-4523-a80f-b68125a80752","source":{"files":[{"content":"rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    function isOwner(userId) {\n      return request.auth != null && request.auth.uid == userId;\n    }\n\n    function onlyKeys(allowed) {\n      return request.resource.data.keys().hasOnly(allowed);\n    }\n\n    function isUserDoc() {\n      return onlyKeys([\n        \"email\",\n        \"displayName\",\n        \"avatarId\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"schemaVersion\"\n      ])\n      && (!(\"email\" in request.resource.data) || request.resource.data.email is string)\n      && (!(\"displayName\" in request.resource.data) || request.resource.data.displayName == null || request.resource.data.displayName is string)\n      && (!(\"avatarId\" in request.resource.data) || request.resource.data.avatarId is string)\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int);\n    }\n\n    function isPreferencesV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"theme\",\n        \"defaultTaskTimerFormat\",\n        \"dynamicColorsEnabled\",\n        \"checkpointAlertSoundEnabled\",\n        \"checkpointAlertToastEnabled\",\n        \"modeSettings\",\n        \"updatedAtMs\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"theme\" in request.resource.data) || request.resource.data.theme in [\"light\", \"dark\"])\n      && (!(\"defaultTaskTimerFormat\" in request.resource.data) || request.resource.data.defaultTaskTimerFormat in [\"day\", \"hour\", \"minute\"])\n      && (!(\"dynamicColorsEnabled\" in request.resource.data) || request.resource.data.dynamicColorsEnabled is bool)\n      && (!(\"checkpointAlertSoundEnabled\" in request.resource.data) || request.resource.data.checkpointAlertSoundEnabled is bool)\n      && (!(\"checkpointAlertToastEnabled\" in request.resource.data) || request.resource.data.checkpointAlertToastEnabled is bool)\n      && (!(\"modeSettings\" in request.resource.data) || request.resource.data.modeSettings == null || request.resource.data.modeSettings is map)\n      && (!(\"updatedAtMs\" in request.resource.data) || request.resource.data.updatedAtMs is int)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isDashboardV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"order\",\n        \"widgets\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"order\" in request.resource.data) || request.resource.data.order is list)\n      && (!(\"widgets\" in request.resource.data) || request.resource.data.widgets is map)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isTaskUiV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"historyRangeDaysByTaskId\",\n        \"historyRangeModeByTaskId\",\n        \"pinnedHistoryTaskIds\",\n        \"customTaskNames\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"historyRangeDaysByTaskId\" in request.resource.data) || request.resource.data.historyRangeDaysByTaskId is map)\n      && (!(\"historyRangeModeByTaskId\" in request.resource.data) || request.resource.data.historyRangeModeByTaskId is map)\n      && (!(\"pinnedHistoryTaskIds\" in request.resource.data) || request.resource.data.pinnedHistoryTaskIds is list)\n      && (!(\"customTaskNames\" in request.resource.data) || request.resource.data.customTaskNames is list)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isAccountStateV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"friendInviteKey\",\n        \"friendInviteKeyExpiresAt\",\n        \"deleteReauthPending\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"friendInviteKey\" in request.resource.data) || request.resource.data.friendInviteKey == null || request.resource.data.friendInviteKey is string)\n      && (!(\"friendInviteKeyExpiresAt\" in request.resource.data) || request.resource.data.friendInviteKeyExpiresAt == null || request.resource.data.friendInviteKeyExpiresAt is int)\n      && (!(\"deleteReauthPending\" in request.resource.data) || request.resource.data.deleteReauthPending is bool)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isTaskDoc() {\n      return onlyKeys([\n        \"id\",\n        \"name\",\n        \"order\",\n        \"collapsed\",\n        \"color\",\n        \"accumulatedMs\",\n        \"running\",\n        \"startMs\",\n        \"hasStarted\",\n        \"checkpointsEnabled\",\n        \"checkpointTimeUnit\",\n        \"checkpoints\",\n        \"checkpointSoundEnabled\",\n        \"checkpointSoundMode\",\n        \"checkpointToastEnabled\",\n        \"checkpointToastMode\",\n        \"finalCheckpointAction\",\n        \"presetIntervalsEnabled\",\n        \"presetIntervalValue\",\n        \"presetIntervalLastCheckpointId\",\n        \"presetIntervalNextSeq\",\n        \"mode\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"schemaVersion\"\n      ])\n      && (!(\"id\" in request.resource.data) || request.resource.data.id is string)\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"order\" in request.resource.data) || request.resource.data.order is int)\n      && (!(\"collapsed\" in request.resource.data) || request.resource.data.collapsed is bool)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"accumulatedMs\" in request.resource.data) || request.resource.data.accumulatedMs is int)\n      && (!(\"running\" in request.resource.data) || request.resource.data.running is bool)\n      && (!(\"startMs\" in request.resource.data) || request.resource.data.startMs == null || request.resource.data.startMs is int)\n      && (!(\"hasStarted\" in request.resource.data) || request.resource.data.hasStarted is bool)\n      && (!(\"checkpointsEnabled\" in request.resource.data) || request.resource.data.checkpointsEnabled is bool)\n      && (!(\"checkpointTimeUnit\" in request.resource.data) || request.resource.data.checkpointTimeUnit in [\"day\", \"hour\", \"minute\"])\n      && (!(\"checkpoints\" in request.resource.data) || request.resource.data.checkpoints is list)\n      && (!(\"checkpointSoundEnabled\" in request.resource.data) || request.resource.data.checkpointSoundEnabled is bool)\n      && (!(\"checkpointSoundMode\" in request.resource.data) || request.resource.data.checkpointSoundMode in [\"once\", \"repeat\"])\n      && (!(\"checkpointToastEnabled\" in request.resource.data) || request.resource.data.checkpointToastEnabled is bool)\n      && (!(\"checkpointToastMode\" in request.resource.data) || request.resource.data.checkpointToastMode in [\"auto5s\", \"manual\"])\n      && (!(\"finalCheckpointAction\" in request.resource.data) || request.resource.data.finalCheckpointAction in [\"continue\", \"resetLog\", \"resetNoLog\"])\n      && (!(\"presetIntervalsEnabled\" in request.resource.data) || request.resource.data.presetIntervalsEnabled is bool)\n      && (!(\"presetIntervalValue\" in request.resource.data) || request.resource.data.presetIntervalValue is int || request.resource.data.presetIntervalValue is float)\n      && (!(\"presetIntervalLastCheckpointId\" in request.resource.data) || request.resource.data.presetIntervalLastCheckpointId == null || request.resource.data.presetIntervalLastCheckpointId is string)\n      && (!(\"presetIntervalNextSeq\" in request.resource.data) || request.resource.data.presetIntervalNextSeq is int)\n      && (!(\"mode\" in request.resource.data) || request.resource.data.mode in [\"mode1\", \"mode2\", \"mode3\"])\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int);\n    }\n\n    function isHistoryDoc() {\n      return onlyKeys([\n        \"ts\",\n        \"name\",\n        \"ms\",\n        \"color\",\n        \"createdAt\"\n      ])\n      && (!(\"ts\" in request.resource.data) || request.resource.data.ts is int)\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"ms\" in request.resource.data) || request.resource.data.ms is int)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp);\n    }\n\n    function isDeletedTaskDoc() {\n      return onlyKeys([\n        \"name\",\n        \"color\",\n        \"deletedAt\",\n        \"updatedAt\"\n      ])\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"deletedAt\" in request.resource.data) || request.resource.data.deletedAt is int)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isFriendRequestDocShape() {\n      return onlyKeys([\n        \"requestId\",\n        \"senderUid\",\n        \"receiverUid\",\n        \"senderEmail\",\n        \"receiverEmail\",\n        \"status\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"respondedAt\",\n        \"respondedBy\"\n      ])\n      && (!(\"requestId\" in request.resource.data) || request.resource.data.requestId is string)\n      && (!(\"senderUid\" in request.resource.data) || request.resource.data.senderUid is string)\n      && (!(\"receiverUid\" in request.resource.data) || request.resource.data.receiverUid is string)\n      && (!(\"senderEmail\" in request.resource.data) || request.resource.data.senderEmail == null || request.resource.data.senderEmail is string)\n      && (!(\"receiverEmail\" in request.resource.data) || request.resource.data.receiverEmail == null || request.resource.data.receiverEmail is string)\n      && (!(\"status\" in request.resource.data) || request.resource.data.status in [\"pending\", \"approved\", \"declined\"])\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt != null)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt != null)\n      && (!(\"respondedAt\" in request.resource.data) || request.resource.data.respondedAt == null || request.resource.data.respondedAt != null)\n      && (!(\"respondedBy\" in request.resource.data) || request.resource.data.respondedBy == null || request.resource.data.respondedBy is string);\n    }\n\n    function isFriendRequestCreateDoc() {\n      return isFriendRequestDocShape()\n      && request.resource.data.keys().hasAll([\n        \"requestId\",\n        \"senderUid\",\n        \"receiverUid\",\n        \"status\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"respondedAt\",\n        \"respondedBy\"\n      ])\n      && request.resource.data.requestId == (\"pending:\" + request.resource.data.senderUid + \":\" + request.resource.data.receiverUid)\n      && request.resource.data.status == \"pending\"\n      && request.resource.data.senderUid != request.resource.data.receiverUid\n      && request.resource.data.respondedAt == null\n      && request.resource.data.respondedBy == null;\n    }\n\n    function isFriendRequestDecisionUpdate() {\n      return isFriendRequestDocShape()\n      && request.auth != null\n      && request.auth.uid == resource.data.receiverUid\n      && resource.data.status == \"pending\"\n      && request.resource.data.status in [\"approved\", \"declined\"]\n      && request.resource.data.requestId == resource.data.requestId\n      && request.resource.data.senderUid == resource.data.senderUid\n      && request.resource.data.receiverUid == resource.data.receiverUid\n      && request.resource.data.createdAt == resource.data.createdAt\n      && request.resource.data.respondedBy == request.auth.uid\n      && request.resource.data.respondedAt is timestamp;\n    }\n\n    function isFriendRequestRetryUpdate() {\n      return isFriendRequestDocShape()\n      && request.auth != null\n      && request.auth.uid == resource.data.senderUid\n      && resource.data.status in [\"approved\", \"declined\"]\n      && request.resource.data.status == \"pending\"\n      && request.resource.data.requestId == resource.data.requestId\n      && request.resource.data.senderUid == resource.data.senderUid\n      && request.resource.data.receiverUid == resource.data.receiverUid\n      && request.resource.data.createdAt == resource.data.createdAt\n      && request.resource.data.respondedBy == null\n      && request.resource.data.respondedAt == null;\n    }\n\n    function isFriendshipDocCreate() {\n      return onlyKeys([\n        \"pairId\",\n        \"users\",\n        \"createdAt\",\n        \"createdBy\"\n      ])\n      && request.resource.data.keys().hasAll([\n        \"pairId\",\n        \"users\",\n        \"createdAt\",\n        \"createdBy\"\n      ])\n      && request.auth != null\n      && request.resource.data.pairId is string\n      && request.resource.data.users is list\n      && request.resource.data.users.size() == 2\n      && request.resource.data.users[0] is string\n      && request.resource.data.users[1] is string\n      && request.resource.data.users[0] != request.resource.data.users[1]\n      && request.auth.uid in request.resource.data.users\n      && request.resource.data.createdAt is timestamp\n      && request.resource.data.createdBy is string\n      && (\n        (\n          request.resource.data.users[0] < request.resource.data.users[1]\n          && request.resource.data.pairId == (\"pair:\" + request.resource.data.users[0] + \":\" + request.resource.data.users[1])\n        )\n        || (\n          request.resource.data.users[1] < request.resource.data.users[0]\n          && request.resource.data.pairId == (\"pair:\" + request.resource.data.users[1] + \":\" + request.resource.data.users[0])\n        )\n      );\n    }\n\n    match /users/{userId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isUserDoc();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/preferences/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isPreferencesV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/dashboard/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isDashboardV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/taskUi/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isTaskUiV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/accountState/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isAccountStateV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/tasks/{taskId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isTaskDoc();\n      allow delete: if isOwner(userId);\n\n      match /history/{entryId} {\n        allow read: if isOwner(userId);\n        allow create, update: if isOwner(userId) && isHistoryDoc();\n        allow delete: if isOwner(userId);\n      }\n    }\n\n    match /users/{userId}/deletedTasks/{taskId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isDeletedTaskDoc();\n      allow delete: if isOwner(userId);\n    }\n\n    match /friend_requests/{requestId} {\n      allow read: if request.auth != null\n        && (request.auth.uid == resource.data.senderUid || request.auth.uid == resource.data.receiverUid);\n      allow create: if request.auth != null\n        && request.auth.uid == request.resource.data.senderUid\n        && isFriendRequestCreateDoc();\n      allow update: if isFriendRequestDecisionUpdate() || isFriendRequestRetryUpdate();\n      allow delete: if false;\n    }\n\n    match /friendships/{pairId} {\n      allow read: if request.auth != null && request.auth.uid in resource.data.users;\n      allow create: if isFriendshipDocCreate();\n      allow update, delete: if false;\n    }\n\n    match /userEmailLookup/{emailKey} {\n      allow read: if request.auth != null;\n      allow create, update: if request.auth != null\n        && request.resource.data.uid is string\n        && request.resource.data.uid == request.auth.uid\n        && request.resource.data.email is string\n        && (!(\"displayName\" in request.resource.data)\n          || request.resource.data.displayName == null\n          || request.resource.data.displayName is string)\n        && (!(\"createdAt\" in request.resource.data)\n          || request.resource.data.createdAt != null)\n        && (!(\"updatedAt\" in request.resource.data)\n          || request.resource.data.updatedAt != null);\n      allow delete: if false;\n    }\n  }\n}\n\r\n","name":"firestore.rules"}]},"createTime":"2026-03-01T05:12:20.068895Z","metadata":{"services":["cloud.firestore"]}}
[debug] [2026-03-01T05:12:20.370Z] [rules] created ruleset projects/tasktimer-prod/rulesets/ba6c38f3-b163-4523-a80f-b68125a80752
[debug] [2026-03-01T05:12:20.370Z] [rules] releasing cloud.firestore/timebase with ruleset projects/tasktimer-prod/rulesets/ba6c38f3-b163-4523-a80f-b68125a80752
[debug] [2026-03-01T05:12:20.371Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:12:20.371Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:12:20.371Z] >>> [apiv2][query] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase [none]
[debug] [2026-03-01T05:12:20.371Z] >>> [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase {"release":{"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/ba6c38f3-b163-4523-a80f-b68125a80752"}}
[debug] [2026-03-01T05:12:20.890Z] <<< [apiv2][status] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase 200
[debug] [2026-03-01T05:12:20.891Z] <<< [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase {"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/ba6c38f3-b163-4523-a80f-b68125a80752","createTime":"2026-02-28T10:53:36.946559Z","updateTime":"2026-03-01T05:12:20.592831Z"}
[debug] [2026-03-01T05:12:20.891Z] [rules] updated release projects/tasktimer-prod/releases/cloud.firestore/timebase
[info] +  firestore: released rules firestore.rules to cloud.firestore 
[info] 
[info] +  Deploy complete! 
[info] 
[info] Project Console: https://console.firebase.google.com/project/tasktimer-prod/overview
[debug] [2026-03-01T05:14:30.241Z] ----------------------------------------------------------------------
[debug] [2026-03-01T05:14:30.247Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\anive\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js deploy --only firestore:rules
[debug] [2026-03-01T05:14:30.247Z] CLI Version:   15.8.0
[debug] [2026-03-01T05:14:30.248Z] Platform:      win32
[debug] [2026-03-01T05:14:30.248Z] Node Version:  v24.13.1
[debug] [2026-03-01T05:14:30.248Z] Time:          Sun Mar 01 2026 16:14:30 GMT+1100 (Australian Eastern Daylight Time)
[debug] [2026-03-01T05:14:30.248Z] ----------------------------------------------------------------------
[debug] 
[debug] [2026-03-01T05:14:34.271Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2026-03-01T05:14:34.272Z] > authorizing via signed-in user (aniven82@gmail.com)
[debug] [2026-03-01T05:14:34.272Z] [iam] checking project tasktimer-prod for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2026-03-01T05:14:34.274Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:14:34.274Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:14:34.275Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions [none]
[debug] [2026-03-01T05:14:34.276Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions  x-goog-user-project=tasktimer-prod
[debug] [2026-03-01T05:14:34.276Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2026-03-01T05:14:34.721Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions 200
[debug] [2026-03-01T05:14:34.721Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'tasktimer-prod'...
[info] 
[info] i  deploying firestore 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[debug] [2026-03-01T05:14:34.727Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:14:34.727Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:14:34.727Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase [none]
[debug] [2026-03-01T05:14:34.963Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase 200
[debug] [2026-03-01T05:14:34.963Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase {"name":"projects/tasktimer-prod/databases/timebase","uid":"dcd38a9d-dfb3-4ec0-9c47-3d395bdca42b","createTime":"2026-02-28T10:53:28.599115Z","updateTime":"2026-02-28T10:53:28.599115Z","locationId":"australia-southeast2","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2026-03-01T04:14:34.807992Z","appEngineIntegrationMode":"DISABLED","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":false,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"IP6pqN74/ZIDMMv4p7iD/JID"}
[info] i  cloud.firestore: checking firestore.rules for compilation errors... 
[debug] [2026-03-01T05:14:34.964Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:14:34.964Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:14:34.965Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test [none]
[debug] [2026-03-01T05:14:34.965Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test [omitted]
[debug] [2026-03-01T05:14:35.565Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test 200
[debug] [2026-03-01T05:14:35.565Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test {}
[info] +  cloud.firestore: rules file firestore.rules compiled successfully 
[debug] [2026-03-01T05:14:35.567Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:14:35.567Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:14:35.568Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases pageSize=10&pageToken=
[debug] [2026-03-01T05:14:36.869Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases 200
[debug] [2026-03-01T05:14:36.869Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases {"releases":[{"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/ba6c38f3-b163-4523-a80f-b68125a80752","createTime":"2026-02-28T10:53:36.946559Z","updateTime":"2026-03-01T05:12:20.592831Z"},{"name":"projects/tasktimer-prod/releases/firebase.storage/tasktimer-prod.firebasestorage.app","rulesetName":"projects/tasktimer-prod/rulesets/ede5bb01-bb12-4bbb-8fcf-22ca8360ba5a","createTime":"2026-02-25T22:57:18.663407Z","updateTime":"2026-02-25T22:57:18.663407Z"}]}
[debug] [2026-03-01T05:14:36.884Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:14:36.885Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:14:36.885Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/ba6c38f3-b163-4523-a80f-b68125a80752 [none]
[debug] [2026-03-01T05:14:38.244Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/ba6c38f3-b163-4523-a80f-b68125a80752 200
[debug] [2026-03-01T05:14:38.245Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/ba6c38f3-b163-4523-a80f-b68125a80752 [omitted]
[info] i  firestore: uploading rules firestore.rules... 
[debug] [2026-03-01T05:14:38.246Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:14:38.246Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:14:38.247Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets [none]
[debug] [2026-03-01T05:14:38.247Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets [omitted]
[debug] [2026-03-01T05:14:39.811Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets 200
[debug] [2026-03-01T05:14:39.811Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets {"name":"projects/tasktimer-prod/rulesets/ffb4ca70-6eed-4036-85d0-db77c2651c11","source":{"files":[{"content":"rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    function isOwner(userId) {\n      return request.auth != null && request.auth.uid == userId;\n    }\n\n    function onlyKeys(allowed) {\n      return request.resource.data.keys().hasOnly(allowed);\n    }\n\n    function isUserDoc() {\n      return onlyKeys([\n        \"email\",\n        \"displayName\",\n        \"avatarId\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"schemaVersion\"\n      ])\n      && (!(\"email\" in request.resource.data) || request.resource.data.email is string)\n      && (!(\"displayName\" in request.resource.data) || request.resource.data.displayName == null || request.resource.data.displayName is string)\n      && (!(\"avatarId\" in request.resource.data) || request.resource.data.avatarId is string)\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int);\n    }\n\n    function isPreferencesV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"theme\",\n        \"defaultTaskTimerFormat\",\n        \"dynamicColorsEnabled\",\n        \"checkpointAlertSoundEnabled\",\n        \"checkpointAlertToastEnabled\",\n        \"modeSettings\",\n        \"updatedAtMs\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"theme\" in request.resource.data) || request.resource.data.theme in [\"light\", \"dark\"])\n      && (!(\"defaultTaskTimerFormat\" in request.resource.data) || request.resource.data.defaultTaskTimerFormat in [\"day\", \"hour\", \"minute\"])\n      && (!(\"dynamicColorsEnabled\" in request.resource.data) || request.resource.data.dynamicColorsEnabled is bool)\n      && (!(\"checkpointAlertSoundEnabled\" in request.resource.data) || request.resource.data.checkpointAlertSoundEnabled is bool)\n      && (!(\"checkpointAlertToastEnabled\" in request.resource.data) || request.resource.data.checkpointAlertToastEnabled is bool)\n      && (!(\"modeSettings\" in request.resource.data) || request.resource.data.modeSettings == null || request.resource.data.modeSettings is map)\n      && (!(\"updatedAtMs\" in request.resource.data) || request.resource.data.updatedAtMs is int)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isDashboardV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"order\",\n        \"widgets\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"order\" in request.resource.data) || request.resource.data.order is list)\n      && (!(\"widgets\" in request.resource.data) || request.resource.data.widgets is map)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isTaskUiV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"historyRangeDaysByTaskId\",\n        \"historyRangeModeByTaskId\",\n        \"pinnedHistoryTaskIds\",\n        \"customTaskNames\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"historyRangeDaysByTaskId\" in request.resource.data) || request.resource.data.historyRangeDaysByTaskId is map)\n      && (!(\"historyRangeModeByTaskId\" in request.resource.data) || request.resource.data.historyRangeModeByTaskId is map)\n      && (!(\"pinnedHistoryTaskIds\" in request.resource.data) || request.resource.data.pinnedHistoryTaskIds is list)\n      && (!(\"customTaskNames\" in request.resource.data) || request.resource.data.customTaskNames is list)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isAccountStateV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"friendInviteKey\",\n        \"friendInviteKeyExpiresAt\",\n        \"deleteReauthPending\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"friendInviteKey\" in request.resource.data) || request.resource.data.friendInviteKey == null || request.resource.data.friendInviteKey is string)\n      && (!(\"friendInviteKeyExpiresAt\" in request.resource.data) || request.resource.data.friendInviteKeyExpiresAt == null || request.resource.data.friendInviteKeyExpiresAt is int)\n      && (!(\"deleteReauthPending\" in request.resource.data) || request.resource.data.deleteReauthPending is bool)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isTaskDoc() {\n      return onlyKeys([\n        \"id\",\n        \"name\",\n        \"order\",\n        \"collapsed\",\n        \"color\",\n        \"accumulatedMs\",\n        \"running\",\n        \"startMs\",\n        \"hasStarted\",\n        \"checkpointsEnabled\",\n        \"checkpointTimeUnit\",\n        \"checkpoints\",\n        \"checkpointSoundEnabled\",\n        \"checkpointSoundMode\",\n        \"checkpointToastEnabled\",\n        \"checkpointToastMode\",\n        \"finalCheckpointAction\",\n        \"presetIntervalsEnabled\",\n        \"presetIntervalValue\",\n        \"presetIntervalLastCheckpointId\",\n        \"presetIntervalNextSeq\",\n        \"mode\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"schemaVersion\"\n      ])\n      && (!(\"id\" in request.resource.data) || request.resource.data.id is string)\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"order\" in request.resource.data) || request.resource.data.order is int)\n      && (!(\"collapsed\" in request.resource.data) || request.resource.data.collapsed is bool)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"accumulatedMs\" in request.resource.data) || request.resource.data.accumulatedMs is int)\n      && (!(\"running\" in request.resource.data) || request.resource.data.running is bool)\n      && (!(\"startMs\" in request.resource.data) || request.resource.data.startMs == null || request.resource.data.startMs is int)\n      && (!(\"hasStarted\" in request.resource.data) || request.resource.data.hasStarted is bool)\n      && (!(\"checkpointsEnabled\" in request.resource.data) || request.resource.data.checkpointsEnabled is bool)\n      && (!(\"checkpointTimeUnit\" in request.resource.data) || request.resource.data.checkpointTimeUnit in [\"day\", \"hour\", \"minute\"])\n      && (!(\"checkpoints\" in request.resource.data) || request.resource.data.checkpoints is list)\n      && (!(\"checkpointSoundEnabled\" in request.resource.data) || request.resource.data.checkpointSoundEnabled is bool)\n      && (!(\"checkpointSoundMode\" in request.resource.data) || request.resource.data.checkpointSoundMode in [\"once\", \"repeat\"])\n      && (!(\"checkpointToastEnabled\" in request.resource.data) || request.resource.data.checkpointToastEnabled is bool)\n      && (!(\"checkpointToastMode\" in request.resource.data) || request.resource.data.checkpointToastMode in [\"auto5s\", \"manual\"])\n      && (!(\"finalCheckpointAction\" in request.resource.data) || request.resource.data.finalCheckpointAction in [\"continue\", \"resetLog\", \"resetNoLog\"])\n      && (!(\"presetIntervalsEnabled\" in request.resource.data) || request.resource.data.presetIntervalsEnabled is bool)\n      && (!(\"presetIntervalValue\" in request.resource.data) || request.resource.data.presetIntervalValue is int || request.resource.data.presetIntervalValue is float)\n      && (!(\"presetIntervalLastCheckpointId\" in request.resource.data) || request.resource.data.presetIntervalLastCheckpointId == null || request.resource.data.presetIntervalLastCheckpointId is string)\n      && (!(\"presetIntervalNextSeq\" in request.resource.data) || request.resource.data.presetIntervalNextSeq is int)\n      && (!(\"mode\" in request.resource.data) || request.resource.data.mode in [\"mode1\", \"mode2\", \"mode3\"])\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int);\n    }\n\n    function isHistoryDoc() {\n      return onlyKeys([\n        \"ts\",\n        \"name\",\n        \"ms\",\n        \"color\",\n        \"createdAt\"\n      ])\n      && (!(\"ts\" in request.resource.data) || request.resource.data.ts is int)\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"ms\" in request.resource.data) || request.resource.data.ms is int)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp);\n    }\n\n    function isDeletedTaskDoc() {\n      return onlyKeys([\n        \"name\",\n        \"color\",\n        \"deletedAt\",\n        \"updatedAt\"\n      ])\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"deletedAt\" in request.resource.data) || request.resource.data.deletedAt is int)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isFriendRequestDocShape() {\n      return onlyKeys([\n        \"requestId\",\n        \"senderUid\",\n        \"receiverUid\",\n        \"senderEmail\",\n        \"receiverEmail\",\n        \"status\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"respondedAt\",\n        \"respondedBy\"\n      ])\n      && (!(\"requestId\" in request.resource.data) || request.resource.data.requestId is string)\n      && (!(\"senderUid\" in request.resource.data) || request.resource.data.senderUid is string)\n      && (!(\"receiverUid\" in request.resource.data) || request.resource.data.receiverUid is string)\n      && (!(\"senderEmail\" in request.resource.data) || request.resource.data.senderEmail == null || request.resource.data.senderEmail is string)\n      && (!(\"receiverEmail\" in request.resource.data) || request.resource.data.receiverEmail == null || request.resource.data.receiverEmail is string)\n      && (!(\"status\" in request.resource.data) || request.resource.data.status in [\"pending\", \"approved\", \"declined\"])\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt != null)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt != null)\n      && (!(\"respondedAt\" in request.resource.data) || request.resource.data.respondedAt == null || request.resource.data.respondedAt != null)\n      && (!(\"respondedBy\" in request.resource.data) || request.resource.data.respondedBy == null || request.resource.data.respondedBy is string);\n    }\n\n    function isFriendRequestCreateDoc() {\n      return isFriendRequestDocShape()\n      && request.resource.data.keys().hasAll([\n        \"requestId\",\n        \"senderUid\",\n        \"receiverUid\",\n        \"status\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"respondedAt\",\n        \"respondedBy\"\n      ])\n      && request.resource.data.requestId == (\"pending:\" + request.resource.data.senderUid + \":\" + request.resource.data.receiverUid)\n      && request.resource.data.status == \"pending\"\n      && request.resource.data.senderUid != request.resource.data.receiverUid\n      && request.resource.data.respondedAt == null\n      && request.resource.data.respondedBy == null;\n    }\n\n    function isFriendRequestDecisionUpdate() {\n      return isFriendRequestDocShape()\n      && request.auth != null\n      && request.auth.uid == resource.data.receiverUid\n      && resource.data.status == \"pending\"\n      && request.resource.data.status in [\"approved\", \"declined\"]\n      && request.resource.data.requestId == resource.data.requestId\n      && request.resource.data.senderUid == resource.data.senderUid\n      && request.resource.data.receiverUid == resource.data.receiverUid\n      && request.resource.data.createdAt == resource.data.createdAt\n      && request.resource.data.respondedBy == request.auth.uid\n      && request.resource.data.respondedAt is timestamp;\n    }\n\n    function isFriendRequestRetryUpdate() {\n      return isFriendRequestDocShape()\n      && request.auth != null\n      && request.auth.uid == resource.data.senderUid\n      && resource.data.status in [\"approved\", \"declined\"]\n      && request.resource.data.status == \"pending\"\n      && request.resource.data.requestId == resource.data.requestId\n      && request.resource.data.senderUid == resource.data.senderUid\n      && request.resource.data.receiverUid == resource.data.receiverUid\n      && request.resource.data.createdAt == resource.data.createdAt\n      && request.resource.data.respondedBy == null\n      && request.resource.data.respondedAt == null;\n    }\n\n    function isFriendshipDocCreate() {\n      return onlyKeys([\n        \"pairId\",\n        \"users\",\n        \"createdAt\",\n        \"createdBy\"\n      ])\n      && request.resource.data.keys().hasAll([\n        \"pairId\",\n        \"users\",\n        \"createdAt\",\n        \"createdBy\"\n      ])\n      && request.auth != null\n      && request.resource.data.pairId is string\n      && request.resource.data.users is list\n      && request.resource.data.users.size() == 2\n      && request.resource.data.users[0] is string\n      && request.resource.data.users[1] is string\n      && request.resource.data.users[0] != request.resource.data.users[1]\n      && request.auth.uid in request.resource.data.users\n      && request.resource.data.createdAt is timestamp\n      && request.resource.data.createdBy is string\n      && (\n        (\n          request.resource.data.users[0] < request.resource.data.users[1]\n          && request.resource.data.pairId == (\"pair:\" + request.resource.data.users[0] + \":\" + request.resource.data.users[1])\n        )\n        || (\n          request.resource.data.users[1] < request.resource.data.users[0]\n          && request.resource.data.pairId == (\"pair:\" + request.resource.data.users[1] + \":\" + request.resource.data.users[0])\n        )\n      );\n    }\n\n    match /users/{userId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isUserDoc();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/preferences/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isPreferencesV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/dashboard/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isDashboardV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/taskUi/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isTaskUiV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/accountState/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isAccountStateV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/tasks/{taskId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isTaskDoc();\n      allow delete: if isOwner(userId);\n\n      match /history/{entryId} {\n        allow read: if isOwner(userId);\n        allow create, update: if isOwner(userId) && isHistoryDoc();\n        allow delete: if isOwner(userId);\n      }\n    }\n\n    match /users/{userId}/deletedTasks/{taskId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isDeletedTaskDoc();\n      allow delete: if isOwner(userId);\n    }\n\n    match /friend_requests/{requestId} {\n      allow read: if request.auth != null\n        && (request.auth.uid == resource.data.senderUid || request.auth.uid == resource.data.receiverUid);\n      allow create: if request.auth != null\n        && request.auth.uid == request.resource.data.senderUid\n        && isFriendRequestCreateDoc();\n      allow update: if isFriendRequestDecisionUpdate() || isFriendRequestRetryUpdate();\n      allow delete: if false;\n    }\n\n    match /friendships/{pairId} {\n      allow read: if request.auth != null && request.auth.uid in resource.data.users;\n      allow create: if isFriendshipDocCreate();\n      allow update, delete: if false;\n    }\n\n    match /userEmailLookup/{emailKey} {\n      allow read: if request.auth != null;\n      allow create, update: if request.auth != null\n        && request.resource.data.uid is string\n        && request.resource.data.uid == request.auth.uid\n        && request.resource.data.email is string\n        && (!(\"displayName\" in request.resource.data)\n          || request.resource.data.displayName == null\n          || request.resource.data.displayName is string)\n        && (!(\"createdAt\" in request.resource.data)\n          || request.resource.data.createdAt != null)\n        && (!(\"updatedAt\" in request.resource.data)\n          || request.resource.data.updatedAt != null);\n      allow delete: if request.auth != null\n        && resource.data.uid is string\n        && resource.data.uid == request.auth.uid;\n    }\n  }\n}\n\r\n","name":"firestore.rules"}]},"createTime":"2026-03-01T05:14:39.512319Z","metadata":{"services":["cloud.firestore"]}}
[debug] [2026-03-01T05:14:39.812Z] [rules] created ruleset projects/tasktimer-prod/rulesets/ffb4ca70-6eed-4036-85d0-db77c2651c11
[debug] [2026-03-01T05:14:39.812Z] [rules] releasing cloud.firestore/timebase with ruleset projects/tasktimer-prod/rulesets/ffb4ca70-6eed-4036-85d0-db77c2651c11
[debug] [2026-03-01T05:14:39.813Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:14:39.813Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:14:39.813Z] >>> [apiv2][query] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase [none]
[debug] [2026-03-01T05:14:39.813Z] >>> [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase {"release":{"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/ffb4ca70-6eed-4036-85d0-db77c2651c11"}}
[debug] [2026-03-01T05:14:41.337Z] <<< [apiv2][status] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase 200
[debug] [2026-03-01T05:14:41.338Z] <<< [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase {"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/ffb4ca70-6eed-4036-85d0-db77c2651c11","createTime":"2026-02-28T10:53:36.946559Z","updateTime":"2026-03-01T05:14:41.037711Z"}
[debug] [2026-03-01T05:14:41.338Z] [rules] updated release projects/tasktimer-prod/releases/cloud.firestore/timebase
[info] +  firestore: released rules firestore.rules to cloud.firestore 
[info] 
[info] +  Deploy complete! 
[info] 
[info] Project Console: https://console.firebase.google.com/project/tasktimer-prod/overview
[debug] [2026-03-01T05:25:40.797Z] ----------------------------------------------------------------------
[debug] [2026-03-01T05:25:40.801Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\anive\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js deploy --only firestore:rules
[debug] [2026-03-01T05:25:40.802Z] CLI Version:   15.8.0
[debug] [2026-03-01T05:25:40.802Z] Platform:      win32
[debug] [2026-03-01T05:25:40.802Z] Node Version:  v24.13.1
[debug] [2026-03-01T05:25:40.802Z] Time:          Sun Mar 01 2026 16:25:40 GMT+1100 (Australian Eastern Daylight Time)
[debug] [2026-03-01T05:25:40.803Z] ----------------------------------------------------------------------
[debug] 
[debug] [2026-03-01T05:25:44.419Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2026-03-01T05:25:44.420Z] > authorizing via signed-in user (aniven82@gmail.com)
[debug] [2026-03-01T05:25:44.420Z] [iam] checking project tasktimer-prod for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2026-03-01T05:25:44.422Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:25:44.423Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:25:44.424Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions [none]
[debug] [2026-03-01T05:25:44.424Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions  x-goog-user-project=tasktimer-prod
[debug] [2026-03-01T05:25:44.425Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2026-03-01T05:25:45.637Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions 200
[debug] [2026-03-01T05:25:45.638Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'tasktimer-prod'...
[info] 
[info] i  deploying firestore 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[debug] [2026-03-01T05:25:45.642Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:25:45.643Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:25:45.643Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase [none]
[debug] [2026-03-01T05:25:45.873Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase 200
[debug] [2026-03-01T05:25:45.874Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase {"name":"projects/tasktimer-prod/databases/timebase","uid":"dcd38a9d-dfb3-4ec0-9c47-3d395bdca42b","createTime":"2026-02-28T10:53:28.599115Z","updateTime":"2026-02-28T10:53:28.599115Z","locationId":"australia-southeast2","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2026-03-01T04:25:45.713771Z","appEngineIntegrationMode":"DISABLED","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":false,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"IOGUnZ77/ZIDMMv4p7iD/JID"}
[info] i  cloud.firestore: checking firestore.rules for compilation errors... 
[debug] [2026-03-01T05:25:45.875Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:25:45.875Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:25:45.875Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test [none]
[debug] [2026-03-01T05:25:45.876Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test [omitted]
[debug] [2026-03-01T05:25:47.752Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test 200
[debug] [2026-03-01T05:25:47.752Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test {}
[info] +  cloud.firestore: rules file firestore.rules compiled successfully 
[debug] [2026-03-01T05:25:47.754Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:25:47.754Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:25:47.754Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases pageSize=10&pageToken=
[debug] [2026-03-01T05:25:49.228Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases 200
[debug] [2026-03-01T05:25:49.229Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases {"releases":[{"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/503e18eb-a3ac-4ac3-aca7-05a6f46ae084","createTime":"2026-02-28T10:53:36.946559Z","updateTime":"2026-03-01T05:24:39.810479Z"},{"name":"projects/tasktimer-prod/releases/firebase.storage/tasktimer-prod.firebasestorage.app","rulesetName":"projects/tasktimer-prod/rulesets/ede5bb01-bb12-4bbb-8fcf-22ca8360ba5a","createTime":"2026-02-25T22:57:18.663407Z","updateTime":"2026-02-25T22:57:18.663407Z"}]}
[debug] [2026-03-01T05:25:49.245Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:25:49.245Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:25:49.245Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/503e18eb-a3ac-4ac3-aca7-05a6f46ae084 [none]
[debug] [2026-03-01T05:25:50.710Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/503e18eb-a3ac-4ac3-aca7-05a6f46ae084 200
[debug] [2026-03-01T05:25:50.710Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/503e18eb-a3ac-4ac3-aca7-05a6f46ae084 [omitted]
[info] i  firestore: uploading rules firestore.rules... 
[debug] [2026-03-01T05:25:50.712Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:25:50.712Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:25:50.712Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets [none]
[debug] [2026-03-01T05:25:50.712Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets [omitted]
[debug] [2026-03-01T05:25:52.532Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets 200
[debug] [2026-03-01T05:25:52.532Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets {"name":"projects/tasktimer-prod/rulesets/725b7652-fece-4ccb-809f-3c7d703fa5b5","source":{"files":[{"content":"rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    function isOwner(userId) {\n      return request.auth != null && request.auth.uid == userId;\n    }\n\n    function onlyKeys(allowed) {\n      return request.resource.data.keys().hasOnly(allowed);\n    }\n\n    function isUserDoc() {\n      return onlyKeys([\n        \"email\",\n        \"displayName\",\n        \"avatarId\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"schemaVersion\"\n      ])\n      && (!(\"email\" in request.resource.data) || request.resource.data.email is string)\n      && (!(\"displayName\" in request.resource.data) || request.resource.data.displayName == null || request.resource.data.displayName is string)\n      && (!(\"avatarId\" in request.resource.data) || request.resource.data.avatarId is string)\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int);\n    }\n\n    function isPreferencesV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"theme\",\n        \"defaultTaskTimerFormat\",\n        \"dynamicColorsEnabled\",\n        \"checkpointAlertSoundEnabled\",\n        \"checkpointAlertToastEnabled\",\n        \"modeSettings\",\n        \"updatedAtMs\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"theme\" in request.resource.data) || request.resource.data.theme in [\"light\", \"dark\"])\n      && (!(\"defaultTaskTimerFormat\" in request.resource.data) || request.resource.data.defaultTaskTimerFormat in [\"day\", \"hour\", \"minute\"])\n      && (!(\"dynamicColorsEnabled\" in request.resource.data) || request.resource.data.dynamicColorsEnabled is bool)\n      && (!(\"checkpointAlertSoundEnabled\" in request.resource.data) || request.resource.data.checkpointAlertSoundEnabled is bool)\n      && (!(\"checkpointAlertToastEnabled\" in request.resource.data) || request.resource.data.checkpointAlertToastEnabled is bool)\n      && (!(\"modeSettings\" in request.resource.data) || request.resource.data.modeSettings == null || request.resource.data.modeSettings is map)\n      && (!(\"updatedAtMs\" in request.resource.data) || request.resource.data.updatedAtMs is int)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isDashboardV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"order\",\n        \"widgets\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"order\" in request.resource.data) || request.resource.data.order is list)\n      && (!(\"widgets\" in request.resource.data) || request.resource.data.widgets is map)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isTaskUiV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"historyRangeDaysByTaskId\",\n        \"historyRangeModeByTaskId\",\n        \"pinnedHistoryTaskIds\",\n        \"customTaskNames\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"historyRangeDaysByTaskId\" in request.resource.data) || request.resource.data.historyRangeDaysByTaskId is map)\n      && (!(\"historyRangeModeByTaskId\" in request.resource.data) || request.resource.data.historyRangeModeByTaskId is map)\n      && (!(\"pinnedHistoryTaskIds\" in request.resource.data) || request.resource.data.pinnedHistoryTaskIds is list)\n      && (!(\"customTaskNames\" in request.resource.data) || request.resource.data.customTaskNames is list)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isAccountStateV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"friendInviteKey\",\n        \"friendInviteKeyExpiresAt\",\n        \"deleteReauthPending\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"friendInviteKey\" in request.resource.data) || request.resource.data.friendInviteKey == null || request.resource.data.friendInviteKey is string)\n      && (!(\"friendInviteKeyExpiresAt\" in request.resource.data) || request.resource.data.friendInviteKeyExpiresAt == null || request.resource.data.friendInviteKeyExpiresAt is int)\n      && (!(\"deleteReauthPending\" in request.resource.data) || request.resource.data.deleteReauthPending is bool)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isTaskDoc() {\n      return onlyKeys([\n        \"id\",\n        \"name\",\n        \"order\",\n        \"collapsed\",\n        \"color\",\n        \"accumulatedMs\",\n        \"running\",\n        \"startMs\",\n        \"hasStarted\",\n        \"checkpointsEnabled\",\n        \"checkpointTimeUnit\",\n        \"checkpoints\",\n        \"checkpointSoundEnabled\",\n        \"checkpointSoundMode\",\n        \"checkpointToastEnabled\",\n        \"checkpointToastMode\",\n        \"finalCheckpointAction\",\n        \"presetIntervalsEnabled\",\n        \"presetIntervalValue\",\n        \"presetIntervalLastCheckpointId\",\n        \"presetIntervalNextSeq\",\n        \"mode\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"schemaVersion\"\n      ])\n      && (!(\"id\" in request.resource.data) || request.resource.data.id is string)\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"order\" in request.resource.data) || request.resource.data.order is int)\n      && (!(\"collapsed\" in request.resource.data) || request.resource.data.collapsed is bool)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"accumulatedMs\" in request.resource.data) || request.resource.data.accumulatedMs is int)\n      && (!(\"running\" in request.resource.data) || request.resource.data.running is bool)\n      && (!(\"startMs\" in request.resource.data) || request.resource.data.startMs == null || request.resource.data.startMs is int)\n      && (!(\"hasStarted\" in request.resource.data) || request.resource.data.hasStarted is bool)\n      && (!(\"checkpointsEnabled\" in request.resource.data) || request.resource.data.checkpointsEnabled is bool)\n      && (!(\"checkpointTimeUnit\" in request.resource.data) || request.resource.data.checkpointTimeUnit in [\"day\", \"hour\", \"minute\"])\n      && (!(\"checkpoints\" in request.resource.data) || request.resource.data.checkpoints is list)\n      && (!(\"checkpointSoundEnabled\" in request.resource.data) || request.resource.data.checkpointSoundEnabled is bool)\n      && (!(\"checkpointSoundMode\" in request.resource.data) || request.resource.data.checkpointSoundMode in [\"once\", \"repeat\"])\n      && (!(\"checkpointToastEnabled\" in request.resource.data) || request.resource.data.checkpointToastEnabled is bool)\n      && (!(\"checkpointToastMode\" in request.resource.data) || request.resource.data.checkpointToastMode in [\"auto5s\", \"manual\"])\n      && (!(\"finalCheckpointAction\" in request.resource.data) || request.resource.data.finalCheckpointAction in [\"continue\", \"resetLog\", \"resetNoLog\"])\n      && (!(\"presetIntervalsEnabled\" in request.resource.data) || request.resource.data.presetIntervalsEnabled is bool)\n      && (!(\"presetIntervalValue\" in request.resource.data) || request.resource.data.presetIntervalValue is int || request.resource.data.presetIntervalValue is float)\n      && (!(\"presetIntervalLastCheckpointId\" in request.resource.data) || request.resource.data.presetIntervalLastCheckpointId == null || request.resource.data.presetIntervalLastCheckpointId is string)\n      && (!(\"presetIntervalNextSeq\" in request.resource.data) || request.resource.data.presetIntervalNextSeq is int)\n      && (!(\"mode\" in request.resource.data) || request.resource.data.mode in [\"mode1\", \"mode2\", \"mode3\"])\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int);\n    }\n\n    function isHistoryDoc() {\n      return onlyKeys([\n        \"ts\",\n        \"name\",\n        \"ms\",\n        \"color\",\n        \"createdAt\"\n      ])\n      && (!(\"ts\" in request.resource.data) || request.resource.data.ts is int)\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"ms\" in request.resource.data) || request.resource.data.ms is int)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp);\n    }\n\n    function isDeletedTaskDoc() {\n      return onlyKeys([\n        \"name\",\n        \"color\",\n        \"deletedAt\",\n        \"updatedAt\"\n      ])\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"deletedAt\" in request.resource.data) || request.resource.data.deletedAt is int)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isFriendRequestDocShape() {\n      return onlyKeys([\n        \"requestId\",\n        \"senderUid\",\n        \"receiverUid\",\n        \"senderEmail\",\n        \"receiverEmail\",\n        \"status\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"respondedAt\",\n        \"respondedBy\"\n      ])\n      && (!(\"requestId\" in request.resource.data) || request.resource.data.requestId is string)\n      && (!(\"senderUid\" in request.resource.data) || request.resource.data.senderUid is string)\n      && (!(\"receiverUid\" in request.resource.data) || request.resource.data.receiverUid is string)\n      && (!(\"senderEmail\" in request.resource.data) || request.resource.data.senderEmail == null || request.resource.data.senderEmail is string)\n      && (!(\"receiverEmail\" in request.resource.data) || request.resource.data.receiverEmail == null || request.resource.data.receiverEmail is string)\n      && (!(\"status\" in request.resource.data) || request.resource.data.status in [\"pending\", \"approved\", \"declined\"])\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt != null)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt != null)\n      && (!(\"respondedAt\" in request.resource.data) || request.resource.data.respondedAt == null || request.resource.data.respondedAt != null)\n      && (!(\"respondedBy\" in request.resource.data) || request.resource.data.respondedBy == null || request.resource.data.respondedBy is string);\n    }\n\n    function isFriendRequestCreateDoc() {\n      return isFriendRequestDocShape()\n      && request.resource.data.keys().hasAll([\n        \"requestId\",\n        \"senderUid\",\n        \"receiverUid\",\n        \"status\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"respondedAt\",\n        \"respondedBy\"\n      ])\n      && request.resource.data.requestId == (\"pending:\" + request.resource.data.senderUid + \":\" + request.resource.data.receiverUid)\n      && request.resource.data.status == \"pending\"\n      && request.resource.data.senderUid != request.resource.data.receiverUid\n      && request.resource.data.respondedAt == null\n      && request.resource.data.respondedBy == null;\n    }\n\n    function isFriendRequestDecisionUpdate() {\n      return isFriendRequestDocShape()\n      && request.auth != null\n      && request.auth.uid == resource.data.receiverUid\n      && resource.data.status == \"pending\"\n      && request.resource.data.status in [\"approved\", \"declined\"]\n      && request.resource.data.requestId == resource.data.requestId\n      && request.resource.data.senderUid == resource.data.senderUid\n      && request.resource.data.receiverUid == resource.data.receiverUid\n      && request.resource.data.createdAt == resource.data.createdAt\n      && request.resource.data.respondedBy == request.auth.uid\n      && request.resource.data.respondedAt is timestamp;\n    }\n\n    function isFriendRequestRetryUpdate() {\n      return isFriendRequestDocShape()\n      && request.auth != null\n      && request.auth.uid == resource.data.senderUid\n      && resource.data.status in [\"approved\", \"declined\"]\n      && request.resource.data.status == \"pending\"\n      && request.resource.data.requestId == resource.data.requestId\n      && request.resource.data.senderUid == resource.data.senderUid\n      && request.resource.data.receiverUid == resource.data.receiverUid\n      && request.resource.data.createdAt == resource.data.createdAt\n      && request.resource.data.respondedBy == null\n      && request.resource.data.respondedAt == null;\n    }\n\n    function isFriendshipDocCreate() {\n      return onlyKeys([\n        \"pairId\",\n        \"users\",\n        \"createdAt\",\n        \"createdBy\"\n      ])\n      && request.resource.data.keys().hasAll([\n        \"pairId\",\n        \"users\",\n        \"createdAt\",\n        \"createdBy\"\n      ])\n      && request.auth != null\n      && request.resource.data.pairId is string\n      && request.resource.data.users is list\n      && request.resource.data.users.size() == 2\n      && request.resource.data.users[0] is string\n      && request.resource.data.users[1] is string\n      && request.resource.data.users[0] != request.resource.data.users[1]\n      && request.auth.uid in request.resource.data.users\n      && request.resource.data.createdAt is timestamp\n      && request.resource.data.createdBy is string\n      && (\n        (\n          request.resource.data.users[0] < request.resource.data.users[1]\n          && request.resource.data.pairId == (\"pair:\" + request.resource.data.users[0] + \":\" + request.resource.data.users[1])\n        )\n        || (\n          request.resource.data.users[1] < request.resource.data.users[0]\n          && request.resource.data.pairId == (\"pair:\" + request.resource.data.users[1] + \":\" + request.resource.data.users[0])\n        )\n      );\n    }\n\n    match /users/{userId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isUserDoc();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/preferences/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isPreferencesV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/dashboard/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isDashboardV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/taskUi/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isTaskUiV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/accountState/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isAccountStateV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/tasks/{taskId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isTaskDoc();\n      allow delete: if isOwner(userId);\n\n      match /history/{entryId} {\n        allow read: if isOwner(userId);\n        allow create, update: if isOwner(userId) && isHistoryDoc();\n        allow delete: if isOwner(userId);\n      }\n    }\n\n    match /users/{userId}/deletedTasks/{taskId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isDeletedTaskDoc();\n      allow delete: if isOwner(userId);\n    }\n\n    match /friend_requests/{requestId} {\n      allow read: if request.auth != null\n        && (\n          // Existing doc reads by sender/receiver.\n          (resource != null && (request.auth.uid == resource.data.senderUid || request.auth.uid == resource.data.receiverUid))\n          // Transaction pre-read on a non-existent pending doc for sender/receiver pair.\n          || (resource == null && (\n            requestId.matches(\"^pending:\" + request.auth.uid + \":[^:]+$\")\n            || requestId.matches(\"^pending:[^:]+:\" + request.auth.uid + \"$\")\n          ))\n        );\n      allow create: if request.auth != null\n        && request.auth.uid == request.resource.data.senderUid\n        && requestId == request.resource.data.requestId\n        && isFriendRequestCreateDoc();\n      allow update: if isFriendRequestDecisionUpdate() || isFriendRequestRetryUpdate();\n      allow delete: if false;\n    }\n\n    match /friendships/{pairId} {\n      allow read: if request.auth != null && request.auth.uid in resource.data.users;\n      allow create: if isFriendshipDocCreate();\n      allow update, delete: if false;\n    }\n\n    match /userEmailLookup/{emailKey} {\n      allow read: if request.auth != null;\n      allow create, update: if request.auth != null\n        && request.resource.data.uid is string\n        && request.resource.data.uid == request.auth.uid\n        && request.resource.data.email is string\n        && (!(\"displayName\" in request.resource.data)\n          || request.resource.data.displayName == null\n          || request.resource.data.displayName is string)\n        && (!(\"createdAt\" in request.resource.data)\n          || request.resource.data.createdAt != null)\n        && (!(\"updatedAt\" in request.resource.data)\n          || request.resource.data.updatedAt != null);\n      allow delete: if request.auth != null\n        && resource.data.uid is string\n        && resource.data.uid == request.auth.uid;\n    }\n  }\n}\n\r\n","name":"firestore.rules"}]},"createTime":"2026-03-01T05:25:52.192223Z","metadata":{"services":["cloud.firestore"]}}
[debug] [2026-03-01T05:25:52.533Z] [rules] created ruleset projects/tasktimer-prod/rulesets/725b7652-fece-4ccb-809f-3c7d703fa5b5
[debug] [2026-03-01T05:25:52.533Z] [rules] releasing cloud.firestore/timebase with ruleset projects/tasktimer-prod/rulesets/725b7652-fece-4ccb-809f-3c7d703fa5b5
[debug] [2026-03-01T05:25:52.534Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:25:52.534Z] Checked if tokens are valid: true, expires at: 1772343753746
[debug] [2026-03-01T05:25:52.534Z] >>> [apiv2][query] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase [none]
[debug] [2026-03-01T05:25:52.534Z] >>> [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase {"release":{"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/725b7652-fece-4ccb-809f-3c7d703fa5b5"}}
[debug] [2026-03-01T05:25:54.317Z] <<< [apiv2][status] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase 200
[debug] [2026-03-01T05:25:54.317Z] <<< [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase {"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/725b7652-fece-4ccb-809f-3c7d703fa5b5","createTime":"2026-02-28T10:53:36.946559Z","updateTime":"2026-03-01T05:25:53.977775Z"}
[debug] [2026-03-01T05:25:54.317Z] [rules] updated release projects/tasktimer-prod/releases/cloud.firestore/timebase
[info] +  firestore: released rules firestore.rules to cloud.firestore 
[info] 
[info] +  Deploy complete! 
[info] 
[info] Project Console: https://console.firebase.google.com/project/tasktimer-prod/overview
[debug] [2026-03-01T06:23:52.090Z] ----------------------------------------------------------------------
[debug] [2026-03-01T06:23:52.096Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\anive\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js deploy --only firestore:rules
[debug] [2026-03-01T06:23:52.097Z] CLI Version:   15.8.0
[debug] [2026-03-01T06:23:52.097Z] Platform:      win32
[debug] [2026-03-01T06:23:52.097Z] Node Version:  v24.13.1
[debug] [2026-03-01T06:23:52.098Z] Time:          Sun Mar 01 2026 17:23:52 GMT+1100 (Australian Eastern Daylight Time)
[debug] [2026-03-01T06:23:52.098Z] ----------------------------------------------------------------------
[debug] 
[debug] [2026-03-01T06:23:56.444Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2026-03-01T06:23:56.445Z] > authorizing via signed-in user (aniven82@gmail.com)
[debug] [2026-03-01T06:23:56.445Z] [iam] checking project tasktimer-prod for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2026-03-01T06:23:56.447Z] Checked if tokens are valid: false, expires at: 1772343753746
[debug] [2026-03-01T06:23:56.447Z] Checked if tokens are valid: false, expires at: 1772343753746
[debug] [2026-03-01T06:23:56.448Z] > refreshing access token with scopes: []
[debug] [2026-03-01T06:23:56.451Z] >>> [apiv2][query] POST https://www.googleapis.com/oauth2/v3/token [none]
[debug] [2026-03-01T06:23:56.451Z] >>> [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2026-03-01T06:23:56.776Z] <<< [apiv2][status] POST https://www.googleapis.com/oauth2/v3/token 200
[debug] [2026-03-01T06:23:56.776Z] <<< [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2026-03-01T06:23:56.797Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions [none]
[debug] [2026-03-01T06:23:56.798Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions  x-goog-user-project=tasktimer-prod
[debug] [2026-03-01T06:23:56.798Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2026-03-01T06:23:57.915Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions 200
[debug] [2026-03-01T06:23:57.915Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'tasktimer-prod'...
[info] 
[info] i  deploying firestore 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[debug] [2026-03-01T06:23:57.920Z] Checked if tokens are valid: true, expires at: 1772349835777
[debug] [2026-03-01T06:23:57.920Z] Checked if tokens are valid: true, expires at: 1772349835777
[debug] [2026-03-01T06:23:57.920Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase [none]
[debug] [2026-03-01T06:23:58.174Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase 200
[debug] [2026-03-01T06:23:58.174Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase {"name":"projects/tasktimer-prod/databases/timebase","uid":"dcd38a9d-dfb3-4ec0-9c47-3d395bdca42b","createTime":"2026-02-28T10:53:28.599115Z","updateTime":"2026-02-28T10:53:28.599115Z","locationId":"australia-southeast2","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2026-03-01T05:23:57.970879Z","appEngineIntegrationMode":"DISABLED","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":false,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"IJTPu5+I/pIDMMv4p7iD/JID"}
[info] i  cloud.firestore: checking firestore.rules for compilation errors... 
[debug] [2026-03-01T06:23:58.176Z] Checked if tokens are valid: true, expires at: 1772349835777
[debug] [2026-03-01T06:23:58.176Z] Checked if tokens are valid: true, expires at: 1772349835777
[debug] [2026-03-01T06:23:58.176Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test [none]
[debug] [2026-03-01T06:23:58.176Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test [omitted]
[debug] [2026-03-01T06:23:58.837Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test 200
[debug] [2026-03-01T06:23:58.837Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test {}
[info] +  cloud.firestore: rules file firestore.rules compiled successfully 
[debug] [2026-03-01T06:23:58.839Z] Checked if tokens are valid: true, expires at: 1772349835777
[debug] [2026-03-01T06:23:58.839Z] Checked if tokens are valid: true, expires at: 1772349835777
[debug] [2026-03-01T06:23:58.839Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases pageSize=10&pageToken=
[debug] [2026-03-01T06:23:59.381Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases 200
[debug] [2026-03-01T06:23:59.381Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases {"releases":[{"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/e8db8c06-5ad5-4e81-9fd5-136d9236bfcd","createTime":"2026-02-28T10:53:36.946559Z","updateTime":"2026-03-01T06:13:45.455151Z"},{"name":"projects/tasktimer-prod/releases/firebase.storage/tasktimer-prod.firebasestorage.app","rulesetName":"projects/tasktimer-prod/rulesets/ede5bb01-bb12-4bbb-8fcf-22ca8360ba5a","createTime":"2026-02-25T22:57:18.663407Z","updateTime":"2026-02-25T22:57:18.663407Z"}]}
[debug] [2026-03-01T06:23:59.397Z] Checked if tokens are valid: true, expires at: 1772349835777
[debug] [2026-03-01T06:23:59.397Z] Checked if tokens are valid: true, expires at: 1772349835777
[debug] [2026-03-01T06:23:59.397Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/e8db8c06-5ad5-4e81-9fd5-136d9236bfcd [none]
[debug] [2026-03-01T06:24:00.701Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/e8db8c06-5ad5-4e81-9fd5-136d9236bfcd 200
[debug] [2026-03-01T06:24:00.701Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/e8db8c06-5ad5-4e81-9fd5-136d9236bfcd [omitted]
[info] i  firestore: uploading rules firestore.rules... 
[debug] [2026-03-01T06:24:00.703Z] Checked if tokens are valid: true, expires at: 1772349835777
[debug] [2026-03-01T06:24:00.703Z] Checked if tokens are valid: true, expires at: 1772349835777
[debug] [2026-03-01T06:24:00.704Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets [none]
[debug] [2026-03-01T06:24:00.704Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets [omitted]
[debug] [2026-03-01T06:24:01.460Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets 200
[debug] [2026-03-01T06:24:01.460Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets {"name":"projects/tasktimer-prod/rulesets/43439d73-b684-44ac-91dc-ca0672ba354b","source":{"files":[{"content":"rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    function isOwner(userId) {\n      return request.auth != null && request.auth.uid == userId;\n    }\n\n    function onlyKeys(allowed) {\n      return request.resource.data.keys().hasOnly(allowed);\n    }\n\n    function isUserDoc() {\n      return onlyKeys([\n        \"email\",\n        \"displayName\",\n        \"avatarId\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"schemaVersion\"\n      ])\n      && (!(\"email\" in request.resource.data) || request.resource.data.email is string)\n      && (!(\"displayName\" in request.resource.data) || request.resource.data.displayName == null || request.resource.data.displayName is string)\n      && (!(\"avatarId\" in request.resource.data) || request.resource.data.avatarId is string)\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int);\n    }\n\n    function isPreferencesV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"theme\",\n        \"defaultTaskTimerFormat\",\n        \"dynamicColorsEnabled\",\n        \"checkpointAlertSoundEnabled\",\n        \"checkpointAlertToastEnabled\",\n        \"modeSettings\",\n        \"updatedAtMs\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"theme\" in request.resource.data) || request.resource.data.theme in [\"light\", \"dark\"])\n      && (!(\"defaultTaskTimerFormat\" in request.resource.data) || request.resource.data.defaultTaskTimerFormat in [\"day\", \"hour\", \"minute\"])\n      && (!(\"dynamicColorsEnabled\" in request.resource.data) || request.resource.data.dynamicColorsEnabled is bool)\n      && (!(\"checkpointAlertSoundEnabled\" in request.resource.data) || request.resource.data.checkpointAlertSoundEnabled is bool)\n      && (!(\"checkpointAlertToastEnabled\" in request.resource.data) || request.resource.data.checkpointAlertToastEnabled is bool)\n      && (!(\"modeSettings\" in request.resource.data) || request.resource.data.modeSettings == null || request.resource.data.modeSettings is map)\n      && (!(\"updatedAtMs\" in request.resource.data) || request.resource.data.updatedAtMs is int)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isDashboardV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"order\",\n        \"widgets\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"order\" in request.resource.data) || request.resource.data.order is list)\n      && (!(\"widgets\" in request.resource.data) || request.resource.data.widgets is map)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isTaskUiV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"historyRangeDaysByTaskId\",\n        \"historyRangeModeByTaskId\",\n        \"pinnedHistoryTaskIds\",\n        \"customTaskNames\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"historyRangeDaysByTaskId\" in request.resource.data) || request.resource.data.historyRangeDaysByTaskId is map)\n      && (!(\"historyRangeModeByTaskId\" in request.resource.data) || request.resource.data.historyRangeModeByTaskId is map)\n      && (!(\"pinnedHistoryTaskIds\" in request.resource.data) || request.resource.data.pinnedHistoryTaskIds is list)\n      && (!(\"customTaskNames\" in request.resource.data) || request.resource.data.customTaskNames is list)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isAccountStateV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"friendInviteKey\",\n        \"friendInviteKeyExpiresAt\",\n        \"deleteReauthPending\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"friendInviteKey\" in request.resource.data) || request.resource.data.friendInviteKey == null || request.resource.data.friendInviteKey is string)\n      && (!(\"friendInviteKeyExpiresAt\" in request.resource.data) || request.resource.data.friendInviteKeyExpiresAt == null || request.resource.data.friendInviteKeyExpiresAt is int)\n      && (!(\"deleteReauthPending\" in request.resource.data) || request.resource.data.deleteReauthPending is bool)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isTaskDoc() {\n      return onlyKeys([\n        \"id\",\n        \"name\",\n        \"order\",\n        \"collapsed\",\n        \"color\",\n        \"accumulatedMs\",\n        \"running\",\n        \"startMs\",\n        \"hasStarted\",\n        \"checkpointsEnabled\",\n        \"checkpointTimeUnit\",\n        \"checkpoints\",\n        \"checkpointSoundEnabled\",\n        \"checkpointSoundMode\",\n        \"checkpointToastEnabled\",\n        \"checkpointToastMode\",\n        \"finalCheckpointAction\",\n        \"presetIntervalsEnabled\",\n        \"presetIntervalValue\",\n        \"presetIntervalLastCheckpointId\",\n        \"presetIntervalNextSeq\",\n        \"mode\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"schemaVersion\"\n      ])\n      && (!(\"id\" in request.resource.data) || request.resource.data.id is string)\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"order\" in request.resource.data) || request.resource.data.order is int)\n      && (!(\"collapsed\" in request.resource.data) || request.resource.data.collapsed is bool)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"accumulatedMs\" in request.resource.data) || request.resource.data.accumulatedMs is int)\n      && (!(\"running\" in request.resource.data) || request.resource.data.running is bool)\n      && (!(\"startMs\" in request.resource.data) || request.resource.data.startMs == null || request.resource.data.startMs is int)\n      && (!(\"hasStarted\" in request.resource.data) || request.resource.data.hasStarted is bool)\n      && (!(\"checkpointsEnabled\" in request.resource.data) || request.resource.data.checkpointsEnabled is bool)\n      && (!(\"checkpointTimeUnit\" in request.resource.data) || request.resource.data.checkpointTimeUnit in [\"day\", \"hour\", \"minute\"])\n      && (!(\"checkpoints\" in request.resource.data) || request.resource.data.checkpoints is list)\n      && (!(\"checkpointSoundEnabled\" in request.resource.data) || request.resource.data.checkpointSoundEnabled is bool)\n      && (!(\"checkpointSoundMode\" in request.resource.data) || request.resource.data.checkpointSoundMode in [\"once\", \"repeat\"])\n      && (!(\"checkpointToastEnabled\" in request.resource.data) || request.resource.data.checkpointToastEnabled is bool)\n      && (!(\"checkpointToastMode\" in request.resource.data) || request.resource.data.checkpointToastMode in [\"auto5s\", \"manual\"])\n      && (!(\"finalCheckpointAction\" in request.resource.data) || request.resource.data.finalCheckpointAction in [\"continue\", \"resetLog\", \"resetNoLog\"])\n      && (!(\"presetIntervalsEnabled\" in request.resource.data) || request.resource.data.presetIntervalsEnabled is bool)\n      && (!(\"presetIntervalValue\" in request.resource.data) || request.resource.data.presetIntervalValue is int || request.resource.data.presetIntervalValue is float)\n      && (!(\"presetIntervalLastCheckpointId\" in request.resource.data) || request.resource.data.presetIntervalLastCheckpointId == null || request.resource.data.presetIntervalLastCheckpointId is string)\n      && (!(\"presetIntervalNextSeq\" in request.resource.data) || request.resource.data.presetIntervalNextSeq is int)\n      && (!(\"mode\" in request.resource.data) || request.resource.data.mode in [\"mode1\", \"mode2\", \"mode3\"])\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int);\n    }\n\n    function isHistoryDoc() {\n      return onlyKeys([\n        \"ts\",\n        \"name\",\n        \"ms\",\n        \"color\",\n        \"createdAt\"\n      ])\n      && (!(\"ts\" in request.resource.data) || request.resource.data.ts is int)\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"ms\" in request.resource.data) || request.resource.data.ms is int)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp);\n    }\n\n    function isDeletedTaskDoc() {\n      return onlyKeys([\n        \"name\",\n        \"color\",\n        \"deletedAt\",\n        \"updatedAt\"\n      ])\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"deletedAt\" in request.resource.data) || request.resource.data.deletedAt is int)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isFriendRequestDocShape() {\n      return onlyKeys([\n        \"requestId\",\n        \"senderUid\",\n        \"receiverUid\",\n        \"senderEmail\",\n        \"receiverEmail\",\n        \"senderAlias\",\n        \"senderAvatarId\",\n        \"receiverAlias\",\n        \"receiverAvatarId\",\n        \"status\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"respondedAt\",\n        \"respondedBy\"\n      ])\n      && (!(\"requestId\" in request.resource.data) || request.resource.data.requestId is string)\n      && (!(\"senderUid\" in request.resource.data) || request.resource.data.senderUid is string)\n      && (!(\"receiverUid\" in request.resource.data) || request.resource.data.receiverUid is string)\n      && (!(\"senderEmail\" in request.resource.data) || request.resource.data.senderEmail == null || request.resource.data.senderEmail is string)\n      && (!(\"receiverEmail\" in request.resource.data) || request.resource.data.receiverEmail == null || request.resource.data.receiverEmail is string)\n      && (!(\"senderAlias\" in request.resource.data) || request.resource.data.senderAlias == null || request.resource.data.senderAlias is string)\n      && (!(\"senderAvatarId\" in request.resource.data) || request.resource.data.senderAvatarId == null || request.resource.data.senderAvatarId is string)\n      && (!(\"receiverAlias\" in request.resource.data) || request.resource.data.receiverAlias == null || request.resource.data.receiverAlias is string)\n      && (!(\"receiverAvatarId\" in request.resource.data) || request.resource.data.receiverAvatarId == null || request.resource.data.receiverAvatarId is string)\n      && (!(\"status\" in request.resource.data) || request.resource.data.status in [\"pending\", \"approved\", \"declined\"])\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt != null)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt != null)\n      && (!(\"respondedAt\" in request.resource.data) || request.resource.data.respondedAt == null || request.resource.data.respondedAt != null)\n      && (!(\"respondedBy\" in request.resource.data) || request.resource.data.respondedBy == null || request.resource.data.respondedBy is string);\n    }\n\n    function isFriendRequestCreateDoc() {\n      return isFriendRequestDocShape()\n      && request.resource.data.keys().hasAll([\n        \"requestId\",\n        \"senderUid\",\n        \"receiverUid\",\n        \"status\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"respondedAt\",\n        \"respondedBy\"\n      ])\n      && request.resource.data.requestId == (\"pending:\" + request.resource.data.senderUid + \":\" + request.resource.data.receiverUid)\n      && request.resource.data.status == \"pending\"\n      && request.resource.data.senderUid != request.resource.data.receiverUid\n      && request.resource.data.respondedAt == null\n      && request.resource.data.respondedBy == null;\n    }\n\n    function isFriendRequestDecisionUpdate() {\n      return isFriendRequestDocShape()\n      && request.auth != null\n      && request.auth.uid == resource.data.receiverUid\n      && resource.data.status == \"pending\"\n      && request.resource.data.status in [\"approved\", \"declined\"]\n      && request.resource.data.requestId == resource.data.requestId\n      && request.resource.data.senderUid == resource.data.senderUid\n      && request.resource.data.receiverUid == resource.data.receiverUid\n      && request.resource.data.createdAt == resource.data.createdAt\n      && request.resource.data.respondedBy == request.auth.uid\n      && request.resource.data.respondedAt is timestamp;\n    }\n\n    function isFriendRequestRetryUpdate() {\n      return isFriendRequestDocShape()\n      && request.auth != null\n      && request.auth.uid == resource.data.senderUid\n      && resource.data.status in [\"approved\", \"declined\"]\n      && request.resource.data.status == \"pending\"\n      && request.resource.data.requestId == resource.data.requestId\n      && request.resource.data.senderUid == resource.data.senderUid\n      && request.resource.data.receiverUid == resource.data.receiverUid\n      && request.resource.data.createdAt == resource.data.createdAt\n      && request.resource.data.respondedBy == null\n      && request.resource.data.respondedAt == null;\n    }\n\n    function isFriendshipDocCreate() {\n      return onlyKeys([\n        \"pairId\",\n        \"users\",\n        \"profileByUid\",\n        \"createdAt\",\n        \"createdBy\"\n      ])\n      && request.resource.data.keys().hasAll([\n        \"pairId\",\n        \"users\",\n        \"profileByUid\",\n        \"createdAt\",\n        \"createdBy\"\n      ])\n      && request.auth != null\n      && request.resource.data.pairId is string\n      && request.resource.data.users is list\n      && request.resource.data.users.size() == 2\n      && request.resource.data.users[0] is string\n      && request.resource.data.users[1] is string\n      && request.resource.data.users[0] != request.resource.data.users[1]\n      && request.auth.uid in request.resource.data.users\n      && request.resource.data.profileByUid is map\n      && request.resource.data.profileByUid[request.resource.data.users[0]] is map\n      && request.resource.data.profileByUid[request.resource.data.users[1]] is map\n      && request.resource.data.createdAt is timestamp\n      && request.resource.data.createdBy is string\n      && (\n        (\n          request.resource.data.users[0] < request.resource.data.users[1]\n          && request.resource.data.pairId == (\"pair:\" + request.resource.data.users[0] + \":\" + request.resource.data.users[1])\n        )\n        || (\n          request.resource.data.users[1] < request.resource.data.users[0]\n          && request.resource.data.pairId == (\"pair:\" + request.resource.data.users[1] + \":\" + request.resource.data.users[0])\n        )\n      );\n    }\n\n    match /users/{userId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isUserDoc();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/preferences/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isPreferencesV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/dashboard/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isDashboardV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/taskUi/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isTaskUiV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/accountState/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isAccountStateV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/tasks/{taskId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isTaskDoc();\n      allow delete: if isOwner(userId);\n\n      match /history/{entryId} {\n        allow read: if isOwner(userId);\n        allow create, update: if isOwner(userId) && isHistoryDoc();\n        allow delete: if isOwner(userId);\n      }\n    }\n\n    match /users/{userId}/deletedTasks/{taskId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isDeletedTaskDoc();\n      allow delete: if isOwner(userId);\n    }\n\n    match /friend_requests/{requestId} {\n      allow read: if request.auth != null\n        && (\n          // Existing doc reads by sender/receiver.\n          (resource != null && (request.auth.uid == resource.data.senderUid || request.auth.uid == resource.data.receiverUid))\n          // Transaction pre-read on a non-existent pending doc for sender/receiver pair.\n          || (resource == null && (\n            requestId.matches(\"^pending:\" + request.auth.uid + \":[^:]+$\")\n            || requestId.matches(\"^pending:[^:]+:\" + request.auth.uid + \"$\")\n          ))\n        );\n      allow create: if request.auth != null\n        && request.auth.uid == request.resource.data.senderUid\n        && requestId == request.resource.data.requestId\n        && isFriendRequestCreateDoc();\n      allow update: if isFriendRequestDecisionUpdate() || isFriendRequestRetryUpdate();\n      allow delete: if false;\n    }\n\n    match /friendships/{pairId} {\n      allow read: if request.auth != null && request.auth.uid in resource.data.users;\n      allow create: if isFriendshipDocCreate();\n      allow update, delete: if false;\n    }\n\n    match /userEmailLookup/{emailKey} {\n      allow read: if request.auth != null;\n      allow create, update: if request.auth != null\n        && request.resource.data.uid is string\n        && request.resource.data.uid == request.auth.uid\n        && request.resource.data.email is string\n        && (!(\"displayName\" in request.resource.data)\n          || request.resource.data.displayName == null\n          || request.resource.data.displayName is string)\n        && (!(\"createdAt\" in request.resource.data)\n          || request.resource.data.createdAt != null)\n        && (!(\"updatedAt\" in request.resource.data)\n          || request.resource.data.updatedAt != null);\n      allow delete: if request.auth != null\n        && resource.data.uid is string\n        && resource.data.uid == request.auth.uid;\n    }\n  }\n}\n\r\n","name":"firestore.rules"}]},"createTime":"2026-03-01T06:24:01.112063Z","metadata":{"services":["cloud.firestore"]}}
[debug] [2026-03-01T06:24:01.461Z] [rules] created ruleset projects/tasktimer-prod/rulesets/43439d73-b684-44ac-91dc-ca0672ba354b
[debug] [2026-03-01T06:24:01.462Z] [rules] releasing cloud.firestore/timebase with ruleset projects/tasktimer-prod/rulesets/43439d73-b684-44ac-91dc-ca0672ba354b
[debug] [2026-03-01T06:24:01.462Z] Checked if tokens are valid: true, expires at: 1772349835777
[debug] [2026-03-01T06:24:01.462Z] Checked if tokens are valid: true, expires at: 1772349835777
[debug] [2026-03-01T06:24:01.463Z] >>> [apiv2][query] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase [none]
[debug] [2026-03-01T06:24:01.463Z] >>> [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase {"release":{"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/43439d73-b684-44ac-91dc-ca0672ba354b"}}
[debug] [2026-03-01T06:24:03.027Z] <<< [apiv2][status] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase 200
[debug] [2026-03-01T06:24:03.027Z] <<< [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase {"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/43439d73-b684-44ac-91dc-ca0672ba354b","createTime":"2026-02-28T10:53:36.946559Z","updateTime":"2026-03-01T06:24:02.671663Z"}
[debug] [2026-03-01T06:24:03.028Z] [rules] updated release projects/tasktimer-prod/releases/cloud.firestore/timebase
[info] +  firestore: released rules firestore.rules to cloud.firestore 
[info] 
[info] +  Deploy complete! 
[info] 
[info] Project Console: https://console.firebase.google.com/project/tasktimer-prod/overview
[debug] [2026-03-01T07:14:23.661Z] ----------------------------------------------------------------------
[debug] [2026-03-01T07:14:23.666Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\anive\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js deploy --only firestore:rules
[debug] [2026-03-01T07:14:23.666Z] CLI Version:   15.8.0
[debug] [2026-03-01T07:14:23.666Z] Platform:      win32
[debug] [2026-03-01T07:14:23.667Z] Node Version:  v24.13.1
[debug] [2026-03-01T07:14:23.667Z] Time:          Sun Mar 01 2026 18:14:23 GMT+1100 (Australian Eastern Daylight Time)
[debug] [2026-03-01T07:14:23.667Z] ----------------------------------------------------------------------
[debug] 
[debug] [2026-03-01T07:14:27.747Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2026-03-01T07:14:27.748Z] > authorizing via signed-in user (aniven82@gmail.com)
[debug] [2026-03-01T07:14:27.748Z] [iam] checking project tasktimer-prod for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2026-03-01T07:14:27.750Z] Checked if tokens are valid: false, expires at: 1772349835777
[debug] [2026-03-01T07:14:27.750Z] Checked if tokens are valid: false, expires at: 1772349835777
[debug] [2026-03-01T07:14:27.750Z] > refreshing access token with scopes: []
[debug] [2026-03-01T07:14:27.753Z] >>> [apiv2][query] POST https://www.googleapis.com/oauth2/v3/token [none]
[debug] [2026-03-01T07:14:27.753Z] >>> [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2026-03-01T07:14:27.994Z] <<< [apiv2][status] POST https://www.googleapis.com/oauth2/v3/token 200
[debug] [2026-03-01T07:14:27.995Z] <<< [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2026-03-01T07:14:28.014Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions [none]
[debug] [2026-03-01T07:14:28.014Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions  x-goog-user-project=tasktimer-prod
[debug] [2026-03-01T07:14:28.014Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2026-03-01T07:14:28.316Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions 200
[debug] [2026-03-01T07:14:28.317Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/tasktimer-prod:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'tasktimer-prod'...
[info] 
[info] i  deploying firestore 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[debug] [2026-03-01T07:14:28.321Z] Checked if tokens are valid: true, expires at: 1772352866995
[debug] [2026-03-01T07:14:28.321Z] Checked if tokens are valid: true, expires at: 1772352866995
[debug] [2026-03-01T07:14:28.321Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase [none]
[debug] [2026-03-01T07:14:28.555Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase 200
[debug] [2026-03-01T07:14:28.555Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/tasktimer-prod/databases/timebase {"name":"projects/tasktimer-prod/databases/timebase","uid":"dcd38a9d-dfb3-4ec0-9c47-3d395bdca42b","createTime":"2026-02-28T10:53:28.599115Z","updateTime":"2026-02-28T10:53:28.599115Z","locationId":"australia-southeast2","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2026-03-01T06:14:28.317755Z","appEngineIntegrationMode":"DISABLED","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":false,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"IOinucST/pIDMMv4p7iD/JID"}
[info] i  cloud.firestore: checking firestore.rules for compilation errors... 
[debug] [2026-03-01T07:14:28.556Z] Checked if tokens are valid: true, expires at: 1772352866995
[debug] [2026-03-01T07:14:28.557Z] Checked if tokens are valid: true, expires at: 1772352866995
[debug] [2026-03-01T07:14:28.557Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test [none]
[debug] [2026-03-01T07:14:28.557Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test [omitted]
[debug] [2026-03-01T07:14:30.359Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test 200
[debug] [2026-03-01T07:14:30.359Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod:test {}
[info] +  cloud.firestore: rules file firestore.rules compiled successfully 
[debug] [2026-03-01T07:14:30.360Z] Checked if tokens are valid: true, expires at: 1772352866995
[debug] [2026-03-01T07:14:30.360Z] Checked if tokens are valid: true, expires at: 1772352866995
[debug] [2026-03-01T07:14:30.361Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases pageSize=10&pageToken=
[debug] [2026-03-01T07:14:31.672Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases 200
[debug] [2026-03-01T07:14:31.673Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases {"releases":[{"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/43439d73-b684-44ac-91dc-ca0672ba354b","createTime":"2026-02-28T10:53:36.946559Z","updateTime":"2026-03-01T06:24:02.671663Z"},{"name":"projects/tasktimer-prod/releases/firebase.storage/tasktimer-prod.firebasestorage.app","rulesetName":"projects/tasktimer-prod/rulesets/ede5bb01-bb12-4bbb-8fcf-22ca8360ba5a","createTime":"2026-02-25T22:57:18.663407Z","updateTime":"2026-02-25T22:57:18.663407Z"}]}
[debug] [2026-03-01T07:14:31.689Z] Checked if tokens are valid: true, expires at: 1772352866995
[debug] [2026-03-01T07:14:31.689Z] Checked if tokens are valid: true, expires at: 1772352866995
[debug] [2026-03-01T07:14:31.690Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/43439d73-b684-44ac-91dc-ca0672ba354b [none]
[debug] [2026-03-01T07:14:32.988Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/43439d73-b684-44ac-91dc-ca0672ba354b 200
[debug] [2026-03-01T07:14:32.988Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets/43439d73-b684-44ac-91dc-ca0672ba354b [omitted]
[info] i  firestore: uploading rules firestore.rules... 
[debug] [2026-03-01T07:14:32.990Z] Checked if tokens are valid: true, expires at: 1772352866995
[debug] [2026-03-01T07:14:32.990Z] Checked if tokens are valid: true, expires at: 1772352866995
[debug] [2026-03-01T07:14:32.990Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets [none]
[debug] [2026-03-01T07:14:32.991Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets [omitted]
[debug] [2026-03-01T07:14:34.533Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets 200
[debug] [2026-03-01T07:14:34.533Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/rulesets {"name":"projects/tasktimer-prod/rulesets/89626900-3e6e-489a-b401-794231f1df3f","source":{"files":[{"content":"rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    function isOwner(userId) {\n      return request.auth != null && request.auth.uid == userId;\n    }\n\n    function onlyKeys(allowed) {\n      return request.resource.data.keys().hasOnly(allowed);\n    }\n\n    function isUserDoc() {\n      return onlyKeys([\n        \"email\",\n        \"displayName\",\n        \"avatarId\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"schemaVersion\"\n      ])\n      && (!(\"email\" in request.resource.data) || request.resource.data.email is string)\n      && (!(\"displayName\" in request.resource.data) || request.resource.data.displayName == null || request.resource.data.displayName is string)\n      && (!(\"avatarId\" in request.resource.data) || request.resource.data.avatarId is string)\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int);\n    }\n\n    function isPreferencesV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"theme\",\n        \"defaultTaskTimerFormat\",\n        \"dynamicColorsEnabled\",\n        \"checkpointAlertSoundEnabled\",\n        \"checkpointAlertToastEnabled\",\n        \"modeSettings\",\n        \"updatedAtMs\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"theme\" in request.resource.data) || request.resource.data.theme in [\"light\", \"dark\"])\n      && (!(\"defaultTaskTimerFormat\" in request.resource.data) || request.resource.data.defaultTaskTimerFormat in [\"day\", \"hour\", \"minute\"])\n      && (!(\"dynamicColorsEnabled\" in request.resource.data) || request.resource.data.dynamicColorsEnabled is bool)\n      && (!(\"checkpointAlertSoundEnabled\" in request.resource.data) || request.resource.data.checkpointAlertSoundEnabled is bool)\n      && (!(\"checkpointAlertToastEnabled\" in request.resource.data) || request.resource.data.checkpointAlertToastEnabled is bool)\n      && (!(\"modeSettings\" in request.resource.data) || request.resource.data.modeSettings == null || request.resource.data.modeSettings is map)\n      && (!(\"updatedAtMs\" in request.resource.data) || request.resource.data.updatedAtMs is int)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isDashboardV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"order\",\n        \"widgets\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"order\" in request.resource.data) || request.resource.data.order is list)\n      && (!(\"widgets\" in request.resource.data) || request.resource.data.widgets is map)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isTaskUiV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"historyRangeDaysByTaskId\",\n        \"historyRangeModeByTaskId\",\n        \"pinnedHistoryTaskIds\",\n        \"customTaskNames\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"historyRangeDaysByTaskId\" in request.resource.data) || request.resource.data.historyRangeDaysByTaskId is map)\n      && (!(\"historyRangeModeByTaskId\" in request.resource.data) || request.resource.data.historyRangeModeByTaskId is map)\n      && (!(\"pinnedHistoryTaskIds\" in request.resource.data) || request.resource.data.pinnedHistoryTaskIds is list)\n      && (!(\"customTaskNames\" in request.resource.data) || request.resource.data.customTaskNames is list)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isAccountStateV1() {\n      return onlyKeys([\n        \"schemaVersion\",\n        \"friendInviteKey\",\n        \"friendInviteKeyExpiresAt\",\n        \"deleteReauthPending\",\n        \"updatedAt\"\n      ])\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int)\n      && (!(\"friendInviteKey\" in request.resource.data) || request.resource.data.friendInviteKey == null || request.resource.data.friendInviteKey is string)\n      && (!(\"friendInviteKeyExpiresAt\" in request.resource.data) || request.resource.data.friendInviteKeyExpiresAt == null || request.resource.data.friendInviteKeyExpiresAt is int)\n      && (!(\"deleteReauthPending\" in request.resource.data) || request.resource.data.deleteReauthPending is bool)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isTaskDoc() {\n      return onlyKeys([\n        \"id\",\n        \"name\",\n        \"order\",\n        \"collapsed\",\n        \"color\",\n        \"accumulatedMs\",\n        \"running\",\n        \"startMs\",\n        \"hasStarted\",\n        \"checkpointsEnabled\",\n        \"checkpointTimeUnit\",\n        \"checkpoints\",\n        \"checkpointSoundEnabled\",\n        \"checkpointSoundMode\",\n        \"checkpointToastEnabled\",\n        \"checkpointToastMode\",\n        \"finalCheckpointAction\",\n        \"presetIntervalsEnabled\",\n        \"presetIntervalValue\",\n        \"presetIntervalLastCheckpointId\",\n        \"presetIntervalNextSeq\",\n        \"mode\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"schemaVersion\"\n      ])\n      && (!(\"id\" in request.resource.data) || request.resource.data.id is string)\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"order\" in request.resource.data) || request.resource.data.order is int)\n      && (!(\"collapsed\" in request.resource.data) || request.resource.data.collapsed is bool)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"accumulatedMs\" in request.resource.data) || request.resource.data.accumulatedMs is int)\n      && (!(\"running\" in request.resource.data) || request.resource.data.running is bool)\n      && (!(\"startMs\" in request.resource.data) || request.resource.data.startMs == null || request.resource.data.startMs is int)\n      && (!(\"hasStarted\" in request.resource.data) || request.resource.data.hasStarted is bool)\n      && (!(\"checkpointsEnabled\" in request.resource.data) || request.resource.data.checkpointsEnabled is bool)\n      && (!(\"checkpointTimeUnit\" in request.resource.data) || request.resource.data.checkpointTimeUnit in [\"day\", \"hour\", \"minute\"])\n      && (!(\"checkpoints\" in request.resource.data) || request.resource.data.checkpoints is list)\n      && (!(\"checkpointSoundEnabled\" in request.resource.data) || request.resource.data.checkpointSoundEnabled is bool)\n      && (!(\"checkpointSoundMode\" in request.resource.data) || request.resource.data.checkpointSoundMode in [\"once\", \"repeat\"])\n      && (!(\"checkpointToastEnabled\" in request.resource.data) || request.resource.data.checkpointToastEnabled is bool)\n      && (!(\"checkpointToastMode\" in request.resource.data) || request.resource.data.checkpointToastMode in [\"auto5s\", \"manual\"])\n      && (!(\"finalCheckpointAction\" in request.resource.data) || request.resource.data.finalCheckpointAction in [\"continue\", \"resetLog\", \"resetNoLog\"])\n      && (!(\"presetIntervalsEnabled\" in request.resource.data) || request.resource.data.presetIntervalsEnabled is bool)\n      && (!(\"presetIntervalValue\" in request.resource.data) || request.resource.data.presetIntervalValue is int || request.resource.data.presetIntervalValue is float)\n      && (!(\"presetIntervalLastCheckpointId\" in request.resource.data) || request.resource.data.presetIntervalLastCheckpointId == null || request.resource.data.presetIntervalLastCheckpointId is string)\n      && (!(\"presetIntervalNextSeq\" in request.resource.data) || request.resource.data.presetIntervalNextSeq is int)\n      && (!(\"mode\" in request.resource.data) || request.resource.data.mode in [\"mode1\", \"mode2\", \"mode3\"])\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp)\n      && (!(\"schemaVersion\" in request.resource.data) || request.resource.data.schemaVersion is int);\n    }\n\n    function isHistoryDoc() {\n      return onlyKeys([\n        \"ts\",\n        \"name\",\n        \"ms\",\n        \"color\",\n        \"createdAt\"\n      ])\n      && (!(\"ts\" in request.resource.data) || request.resource.data.ts is int)\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"ms\" in request.resource.data) || request.resource.data.ms is int)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt is timestamp);\n    }\n\n    function isDeletedTaskDoc() {\n      return onlyKeys([\n        \"name\",\n        \"color\",\n        \"deletedAt\",\n        \"updatedAt\"\n      ])\n      && (!(\"name\" in request.resource.data) || request.resource.data.name is string)\n      && (!(\"color\" in request.resource.data) || request.resource.data.color == null || request.resource.data.color is string)\n      && (!(\"deletedAt\" in request.resource.data) || request.resource.data.deletedAt is int)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt is timestamp);\n    }\n\n    function isFriendRequestDocShape() {\n      return onlyKeys([\n        \"requestId\",\n        \"senderUid\",\n        \"receiverUid\",\n        \"senderEmail\",\n        \"receiverEmail\",\n        \"senderAlias\",\n        \"senderAvatarId\",\n        \"receiverAlias\",\n        \"receiverAvatarId\",\n        \"status\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"respondedAt\",\n        \"respondedBy\"\n      ])\n      && (!(\"requestId\" in request.resource.data) || request.resource.data.requestId is string)\n      && (!(\"senderUid\" in request.resource.data) || request.resource.data.senderUid is string)\n      && (!(\"receiverUid\" in request.resource.data) || request.resource.data.receiverUid is string)\n      && (!(\"senderEmail\" in request.resource.data) || request.resource.data.senderEmail == null || request.resource.data.senderEmail is string)\n      && (!(\"receiverEmail\" in request.resource.data) || request.resource.data.receiverEmail == null || request.resource.data.receiverEmail is string)\n      && (!(\"senderAlias\" in request.resource.data) || request.resource.data.senderAlias == null || request.resource.data.senderAlias is string)\n      && (!(\"senderAvatarId\" in request.resource.data) || request.resource.data.senderAvatarId == null || request.resource.data.senderAvatarId is string)\n      && (!(\"receiverAlias\" in request.resource.data) || request.resource.data.receiverAlias == null || request.resource.data.receiverAlias is string)\n      && (!(\"receiverAvatarId\" in request.resource.data) || request.resource.data.receiverAvatarId == null || request.resource.data.receiverAvatarId is string)\n      && (!(\"status\" in request.resource.data) || request.resource.data.status in [\"pending\", \"approved\", \"declined\"])\n      && (!(\"createdAt\" in request.resource.data) || request.resource.data.createdAt != null)\n      && (!(\"updatedAt\" in request.resource.data) || request.resource.data.updatedAt != null)\n      && (!(\"respondedAt\" in request.resource.data) || request.resource.data.respondedAt == null || request.resource.data.respondedAt != null)\n      && (!(\"respondedBy\" in request.resource.data) || request.resource.data.respondedBy == null || request.resource.data.respondedBy is string);\n    }\n\n    function isFriendRequestCreateDoc() {\n      return isFriendRequestDocShape()\n      && request.resource.data.keys().hasAll([\n        \"requestId\",\n        \"senderUid\",\n        \"receiverUid\",\n        \"status\",\n        \"createdAt\",\n        \"updatedAt\",\n        \"respondedAt\",\n        \"respondedBy\"\n      ])\n      && request.resource.data.requestId == (\"pending:\" + request.resource.data.senderUid + \":\" + request.resource.data.receiverUid)\n      && request.resource.data.status == \"pending\"\n      && request.resource.data.senderUid != request.resource.data.receiverUid\n      && request.resource.data.respondedAt == null\n      && request.resource.data.respondedBy == null;\n    }\n\n    function isFriendRequestDecisionUpdate() {\n      return isFriendRequestDocShape()\n      && request.auth != null\n      && request.auth.uid == resource.data.receiverUid\n      && resource.data.status == \"pending\"\n      && request.resource.data.status in [\"approved\", \"declined\"]\n      && request.resource.data.requestId == resource.data.requestId\n      && request.resource.data.senderUid == resource.data.senderUid\n      && request.resource.data.receiverUid == resource.data.receiverUid\n      && request.resource.data.createdAt == resource.data.createdAt\n      && request.resource.data.respondedBy == request.auth.uid\n      && request.resource.data.respondedAt is timestamp;\n    }\n\n    function isFriendRequestRetryUpdate() {\n      return isFriendRequestDocShape()\n      && request.auth != null\n      && request.auth.uid == resource.data.senderUid\n      && resource.data.status in [\"approved\", \"declined\"]\n      && request.resource.data.status == \"pending\"\n      && request.resource.data.requestId == resource.data.requestId\n      && request.resource.data.senderUid == resource.data.senderUid\n      && request.resource.data.receiverUid == resource.data.receiverUid\n      && request.resource.data.createdAt == resource.data.createdAt\n      && request.resource.data.respondedBy == null\n      && request.resource.data.respondedAt == null;\n    }\n\n    function isFriendshipDocCreate() {\n      return onlyKeys([\n        \"pairId\",\n        \"users\",\n        \"profileByUid\",\n        \"createdAt\",\n        \"createdBy\"\n      ])\n      && request.resource.data.keys().hasAll([\n        \"pairId\",\n        \"users\",\n        \"profileByUid\",\n        \"createdAt\",\n        \"createdBy\"\n      ])\n      && request.auth != null\n      && request.resource.data.pairId is string\n      && request.resource.data.users is list\n      && request.resource.data.users.size() == 2\n      && request.resource.data.users[0] is string\n      && request.resource.data.users[1] is string\n      && request.resource.data.users[0] != request.resource.data.users[1]\n      && request.auth.uid in request.resource.data.users\n      && request.resource.data.profileByUid is map\n      && request.resource.data.profileByUid[request.resource.data.users[0]] is map\n      && request.resource.data.profileByUid[request.resource.data.users[1]] is map\n      && request.resource.data.createdAt is timestamp\n      && request.resource.data.createdBy is string\n      && (\n        (\n          request.resource.data.users[0] < request.resource.data.users[1]\n          && request.resource.data.pairId == (\"pair:\" + request.resource.data.users[0] + \":\" + request.resource.data.users[1])\n        )\n        || (\n          request.resource.data.users[1] < request.resource.data.users[0]\n          && request.resource.data.pairId == (\"pair:\" + request.resource.data.users[1] + \":\" + request.resource.data.users[0])\n        )\n      );\n    }\n\n    match /users/{userId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isUserDoc();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/preferences/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isPreferencesV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/dashboard/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isDashboardV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/taskUi/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isTaskUiV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/accountState/{docId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && docId == \"v1\" && isAccountStateV1();\n      allow delete: if isOwner(userId);\n    }\n\n    match /users/{userId}/tasks/{taskId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isTaskDoc();\n      allow delete: if isOwner(userId);\n\n      match /history/{entryId} {\n        allow read: if isOwner(userId);\n        allow create, update: if isOwner(userId) && isHistoryDoc();\n        allow delete: if isOwner(userId);\n      }\n    }\n\n    match /users/{userId}/deletedTasks/{taskId} {\n      allow read: if isOwner(userId);\n      allow create, update: if isOwner(userId) && isDeletedTaskDoc();\n      allow delete: if isOwner(userId);\n    }\n\n    match /friend_requests/{requestId} {\n      allow read: if request.auth != null\n        && (\n          // Existing doc reads by sender/receiver.\n          (resource != null && (request.auth.uid == resource.data.senderUid || request.auth.uid == resource.data.receiverUid))\n          // Transaction pre-read on a non-existent pending doc for sender/receiver pair.\n          || (resource == null && (\n            requestId.matches(\"^pending:\" + request.auth.uid + \":[^:]+$\")\n            || requestId.matches(\"^pending:[^:]+:\" + request.auth.uid + \"$\")\n          ))\n        );\n      allow create: if request.auth != null\n        && request.auth.uid == request.resource.data.senderUid\n        && requestId == request.resource.data.requestId\n        && isFriendRequestCreateDoc();\n      allow update: if isFriendRequestDecisionUpdate() || isFriendRequestRetryUpdate();\n      allow delete: if false;\n    }\n\n    match /friendships/{pairId} {\n      allow read: if request.auth != null\n        && (\n          // Existing docs: only members can read.\n          (resource != null && request.auth.uid in resource.data.users)\n          // Non-existent docs: allow pre-read for own pair-id lookups during approval flow.\n          || (resource == null && (\n            pairId.matches(\"^pair:\" + request.auth.uid + \":[^:]+$\")\n            || pairId.matches(\"^pair:[^:]+:\" + request.auth.uid + \"$\")\n          ))\n        );\n      allow create: if isFriendshipDocCreate();\n      allow update, delete: if false;\n    }\n\n    match /userEmailLookup/{emailKey} {\n      allow read: if request.auth != null;\n      allow create, update: if request.auth != null\n        && request.resource.data.uid is string\n        && request.resource.data.uid == request.auth.uid\n        && request.resource.data.email is string\n        && (!(\"displayName\" in request.resource.data)\n          || request.resource.data.displayName == null\n          || request.resource.data.displayName is string)\n        && (!(\"createdAt\" in request.resource.data)\n          || request.resource.data.createdAt != null)\n        && (!(\"updatedAt\" in request.resource.data)\n          || request.resource.data.updatedAt != null);\n      allow delete: if request.auth != null\n        && resource.data.uid is string\n        && resource.data.uid == request.auth.uid;\n    }\n  }\n}\n\r\n","name":"firestore.rules"}]},"createTime":"2026-03-01T07:14:34.144815Z","metadata":{"services":["cloud.firestore"]}}
[debug] [2026-03-01T07:14:34.533Z] [rules] created ruleset projects/tasktimer-prod/rulesets/89626900-3e6e-489a-b401-794231f1df3f
[debug] [2026-03-01T07:14:34.534Z] [rules] releasing cloud.firestore/timebase with ruleset projects/tasktimer-prod/rulesets/89626900-3e6e-489a-b401-794231f1df3f
[debug] [2026-03-01T07:14:34.534Z] Checked if tokens are valid: true, expires at: 1772352866995
[debug] [2026-03-01T07:14:34.535Z] Checked if tokens are valid: true, expires at: 1772352866995
[debug] [2026-03-01T07:14:34.535Z] >>> [apiv2][query] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase [none]
[debug] [2026-03-01T07:14:34.535Z] >>> [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase {"release":{"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/89626900-3e6e-489a-b401-794231f1df3f"}}
[debug] [2026-03-01T07:14:35.294Z] <<< [apiv2][status] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase 200
[debug] [2026-03-01T07:14:35.294Z] <<< [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/tasktimer-prod/releases/cloud.firestore/timebase {"name":"projects/tasktimer-prod/releases/cloud.firestore/timebase","rulesetName":"projects/tasktimer-prod/rulesets/89626900-3e6e-489a-b401-794231f1df3f","createTime":"2026-02-28T10:53:36.946559Z","updateTime":"2026-03-01T07:14:34.900639Z"}
[debug] [2026-03-01T07:14:35.294Z] [rules] updated release projects/tasktimer-prod/releases/cloud.firestore/timebase
[info] +  firestore: released rules firestore.rules to cloud.firestore 
[info] 
[info] +  Deploy complete! 
[info] 
[info] Project Console: https://console.firebase.google.com/project/tasktimer-prod/overview
